{"version":3,"sources":["../../../src/features/unified-share-modal/UnifiedShareModal.js"],"names":["React","injectIntl","Modal","UnifiedShareModalTitle","UnifiedShareForm","RemoveLinkConfirmModal","UnifiedShareModal","props","getInitialData","finally","setState","isFetching","shouldRenderFTUXTooltip","getInitialDataCalled","isConfirmModalOpen","onRemoveLink","displayInModal","closeConfirmModal","sharedLinkEditTagTargetingApi","sharedLinkEditTooltipTargetingApi","state","sharedLinkLoaded","handleFtuxCloseClick","openConfirmModal","initialDataReceived","isEmailLinkSectionExpanded","showCollaboratorList","item","trackingProps","type","typedID","modalTracking","onLoad","prevProps","sharedLink","onLoadSharedLink","prevSharedLink","permissionLevel","url","canInvite","isOpen","onRequestClose","submitting","removeLinkConfirmModalTracking","modalProps","extendedModalProps","focusElementSelector","undefined","renderUSF","removeLink","Component","initiallySelectedContacts","isAllowEditSharedLinkForFileEnabled","createSharedLinkOnLoad","focusSharedLinkOnLoad","restrictedCollabEmails","restrictedGroups","inviteCollabsEmailTracking","sharedLinkEmailTracking","sharedLinkTracking","inviteCollabTracking","collaboratorListTracking","UnifiedShareModalBase"],"mappings":"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","sourcesContent":["// @flow\n\nimport * as React from 'react';\nimport { injectIntl } from 'react-intl';\n\nimport { Modal } from '../../components/modal';\n\nimport UnifiedShareModalTitle from './UnifiedShareModalTitle';\nimport UnifiedShareForm from './UnifiedShareForm';\nimport RemoveLinkConfirmModal from './RemoveLinkConfirmModal';\nimport type { USMProps } from './flowTypes';\n\nimport './UnifiedShareModal.scss';\n\ntype State = {\n    getInitialDataCalled: boolean,\n    isConfirmModalOpen: boolean,\n    isEmailLinkSectionExpanded: boolean,\n    isFetching: boolean,\n    sharedLinkLoaded: boolean,\n    shouldRenderFTUXTooltip: boolean,\n    showCollaboratorList: boolean,\n};\n\nclass UnifiedShareModal extends React.Component<USMProps, State> {\n    static defaultProps = {\n        displayInModal: true,\n        initiallySelectedContacts: [],\n        isAllowEditSharedLinkForFileEnabled: false,\n        createSharedLinkOnLoad: false,\n        focusSharedLinkOnLoad: false,\n        restrictedCollabEmails: [],\n        restrictedGroups: [],\n        trackingProps: {\n            inviteCollabsEmailTracking: {},\n            sharedLinkEmailTracking: {},\n            sharedLinkTracking: {},\n            inviteCollabTracking: {},\n            modalTracking: {},\n            removeLinkConfirmModalTracking: {},\n            collaboratorListTracking: {},\n        },\n    };\n\n    constructor(props: USMProps) {\n        super(props);\n\n        const { initialDataReceived } = props;\n\n        this.state = {\n            getInitialDataCalled: !!initialDataReceived,\n            isConfirmModalOpen: false,\n            isEmailLinkSectionExpanded: false,\n            isFetching: !initialDataReceived,\n            sharedLinkLoaded: false,\n            shouldRenderFTUXTooltip: false,\n            showCollaboratorList: false,\n        };\n    }\n\n    componentDidMount() {\n        const { item, trackingProps } = this.props;\n        const { type, typedID } = item;\n        const { modalTracking } = trackingProps;\n        const { onLoad } = modalTracking;\n        const { getInitialDataCalled } = this.state;\n\n        // This check is to ensure minimum item props are\n        // hydrated before we fetch data\n        if (!getInitialDataCalled && type && typedID) {\n            this.getInitialData();\n        }\n\n        if (onLoad) {\n            onLoad();\n        }\n    }\n\n    componentDidUpdate(prevProps: USMProps) {\n        const { item, sharedLink, trackingProps } = this.props;\n        const { type, typedID } = item;\n        const { modalTracking } = trackingProps;\n        const { onLoadSharedLink } = modalTracking;\n        const prevSharedLink = prevProps.sharedLink;\n        const { getInitialDataCalled } = this.state;\n\n        // This check is to ensure minimum item props are\n        // hydrated before we fetch data\n        if (!getInitialDataCalled && type && typedID) {\n            this.getInitialData();\n        }\n\n        // this ensures that we obtain shared link information the first time data is returned\n        // so we can pass the corresponding permissions in the callback\n        if (!prevSharedLink.permissionLevel && sharedLink.permissionLevel && onLoadSharedLink) {\n            onLoadSharedLink(sharedLink.permissionLevel);\n        }\n\n        // we use state to override the default auto copy prop when a URL comes into view\n        if (prevSharedLink.url !== sharedLink.url && sharedLink.url) {\n            this.setState({ sharedLinkLoaded: true });\n        }\n    }\n\n    getInitialData = () => {\n        const { getInitialData } = this.props;\n\n        getInitialData().finally(() => {\n            this.setState({\n                isFetching: false,\n                shouldRenderFTUXTooltip: true,\n            });\n        });\n        this.setState({ getInitialDataCalled: true });\n    };\n\n    handleFtuxCloseClick = () => {\n        this.setState({\n            shouldRenderFTUXTooltip: false,\n        });\n    };\n\n    openConfirmModal = () => {\n        this.setState({ isConfirmModalOpen: true });\n    };\n\n    closeConfirmModal = () => {\n        this.setState({ isConfirmModalOpen: false });\n    };\n\n    removeLink = () => {\n        const { onRemoveLink, displayInModal } = this.props;\n        onRemoveLink();\n        if (!displayInModal) {\n            this.closeConfirmModal();\n        }\n    };\n\n    renderUSF = () => {\n        const { sharedLinkEditTagTargetingApi, sharedLinkEditTooltipTargetingApi } = this.props;\n        const { isFetching, sharedLinkLoaded, shouldRenderFTUXTooltip } = this.state;\n\n        return (\n            <UnifiedShareForm\n                {...this.props}\n                handleFtuxCloseClick={this.handleFtuxCloseClick}\n                isFetching={isFetching}\n                openConfirmModal={this.openConfirmModal}\n                sharedLinkEditTagTargetingApi={sharedLinkEditTagTargetingApi}\n                sharedLinkEditTooltipTargetingApi={sharedLinkEditTooltipTargetingApi}\n                sharedLinkLoaded={sharedLinkLoaded}\n                shouldRenderFTUXTooltip={shouldRenderFTUXTooltip}\n            />\n        );\n    };\n\n    render() {\n        // Shared link section props\n        const { canInvite, displayInModal, isOpen, item, onRequestClose, submitting, trackingProps } = this.props;\n        const { modalTracking, removeLinkConfirmModalTracking } = trackingProps;\n        const { modalProps } = modalTracking;\n        const { isEmailLinkSectionExpanded, isConfirmModalOpen, showCollaboratorList } = this.state;\n\n        // focus logic at modal level\n        const extendedModalProps = {\n            focusElementSelector: canInvite\n                ? '.bdl-PillSelector-input' // focus on invite collabs field\n                : '.toggle-simple', // focus on shared link toggle\n            ...modalProps,\n        };\n\n        return (\n            <>\n                {displayInModal ? (\n                    <Modal\n                        className=\"be-modal unified-share-modal\"\n                        isOpen={isConfirmModalOpen ? false : isOpen}\n                        onRequestClose={submitting ? undefined : onRequestClose}\n                        title={\n                            <UnifiedShareModalTitle\n                                isEmailLinkSectionExpanded={isEmailLinkSectionExpanded}\n                                showCollaboratorList={showCollaboratorList}\n                                item={item}\n                            />\n                        }\n                        {...extendedModalProps}\n                    >\n                        {this.renderUSF()}\n                    </Modal>\n                ) : (\n                    <div className=\"bdl-UnifiedShareForm-container\">{this.renderUSF()}</div>\n                )}\n                {isConfirmModalOpen && (\n                    <RemoveLinkConfirmModal\n                        isOpen={isConfirmModalOpen}\n                        onRequestClose={this.closeConfirmModal}\n                        removeLink={this.removeLink}\n                        submitting={submitting}\n                        {...removeLinkConfirmModalTracking}\n                    />\n                )}\n            </>\n        );\n    }\n}\n\nexport { UnifiedShareModal as UnifiedShareModalBase };\nexport default injectIntl(UnifiedShareModal);\n"],"file":"UnifiedShareModal.js"}