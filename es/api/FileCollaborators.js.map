{"version":3,"sources":["../../src/api/FileCollaborators.js"],"names":["MarkerBasedAPI","DEFAULT_MAX_COLLABORATORS","FileCollaborators","data","isDestroyed","successCallback","collaboratorSelectorItems","entries","map","collab","item","type","email","login","id","name","fileId","errorCallback","searchStr","includeGroups","trim","getFileCollaborators","filter_term","include_groups","include_uploader_collabs","Error","getBaseApiUrl","requestData","limit","markerGet"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;AAMA,OAAOA,cAAP,MAA2B,kBAA3B;AACA,SAASC,yBAAT,QAA0C,cAA1C;;IASMC,iB;;;;;;;;;;;;;;;;;;qEAoBe,UAACC,IAAD,EAA0C;AACvD,UAAI,MAAKC,WAAL,MAAsB,OAAO,MAAKC,eAAZ,KAAgC,UAA1D,EAAsE;AAClE;AACH,OAHsD,CAKvD;;;AACA,UAAMC,yBAA8D,GAAGH,IAAI,CAACI,OAAL,CAAaC,GAAb,CACnE,UAACC,MAAD,EAAkC;AAC9B,YAAIC,IAAJ;;AACA,YAAID,MAAM,CAACE,IAAP,KAAgB,OAApB,EAA6B;AACzBD,UAAAA,IAAI,GAAGD,MAAP,CADyB,CACV;AAClB,SAFD,MAEO;AACHC,UAAAA,IAAI,GAAGD,MAAP;AACAC,UAAAA,IAAI,CAACE,KAAL,GAAaF,IAAI,CAACG,KAAlB,CAFG,CAEsB;AAC5B;;AACD,eAAO;AACHC,UAAAA,EAAE,EAAEL,MAAM,CAACK,EADR;AAEHC,UAAAA,IAAI,EAAEN,MAAM,CAACM,IAFV;AAGHL,UAAAA,IAAI,EAAJA;AAHG,SAAP;AAKH,OAdkE,CAAvE;;AAiBA,YAAKL,eAAL,mBAA0BF,IAA1B;AAAgCI,QAAAA,OAAO,EAAED;AAAzC;AACH,K;;gFAyC2B,UACxBU,MADwB,EAExBX,eAFwB,EAGxBY,aAHwB,EAIxBC,SAJwB,EAMvB;AAAA,qFADuD,EACvD;AAAA,oCADCC,aACD;AAAA,UADCA,aACD,mCADiB,KACjB;;AACD;AACA,UAAI,CAACD,SAAD,IAAcA,SAAS,CAACE,IAAV,OAAqB,EAAvC,EAA2C;AACvC;AACH;;AAED,YAAKC,oBAAL,CAA0BL,MAA1B,EAAkCX,eAAlC,EAAmDY,aAAnD,EAAkE;AAC9DK,QAAAA,WAAW,EAAEJ,SADiD;AAE9DK,QAAAA,cAAc,EAAEJ,aAF8C;AAG9DK,QAAAA,wBAAwB,EAAE;AAHoC,OAAlE;AAKH,K;;;;;;;;AArGD;;;;;;2BAMOV,E,EAAoB;AACvB,UAAI,CAACA,EAAL,EAAS;AACL,cAAM,IAAIW,KAAJ,CAAU,kBAAV,CAAN;AACH;;AAED,uBAAU,KAAKC,aAAL,EAAV,oBAAwCZ,EAAxC;AACH;AAED;;;;;;;;;AA+BA;;;;;;;;;;yCAWIA,E,EACAT,e,EACAY,a,EAGI;AAAA,UAFJU,WAEI,uEAFkB,EAElB;AAAA,UADJC,KACI,uEADY3B,yBACZ;AACJ;AACA;AACA,WAAK4B,SAAL,CAAe;AACXf,QAAAA,EAAE,EAAFA,EADW;AAEXc,QAAAA,KAAK,EAALA,KAFW;AAGXvB,QAAAA,eAAe,EAAfA,eAHW;AAIXY,QAAAA,aAAa,EAAbA,aAJW;AAKXU,QAAAA,WAAW,EAAXA;AALW,OAAf;AAOH;AAED;;;;;;;;;;;;;;;EA1E4B3B,c;;AAyGhC,eAAeE,iBAAf","sourcesContent":["/**\n * @flow\n * @file Helper for the box collaborators API\n * @author Box\n */\n\nimport MarkerBasedAPI from './MarkerBasedAPI';\nimport { DEFAULT_MAX_COLLABORATORS } from '../constants';\nimport type { ElementsErrorCallback } from '../common/types/api';\nimport type { SelectorItem, SelectorItems, UserMini, GroupMini } from '../common/types/core';\n\ntype CollaboratorsAPIResponse = {\n    entries: Array<GroupMini | UserMini>,\n    next_marker: ?string,\n};\n\nclass FileCollaborators extends MarkerBasedAPI {\n    /**\n     * API URL for comments\n     *\n     * @param {string} [id] - a box file id\n     * @return {string} base url for files\n     */\n    getUrl(id: string): string {\n        if (!id) {\n            throw new Error('Missing file id!');\n        }\n\n        return `${this.getBaseApiUrl()}/files/${id}/collaborators`;\n    }\n\n    /**\n     * Transform result of API response\n     *\n     * @param {Object} data the response data\n     */\n    successHandler = (data: CollaboratorsAPIResponse): void => {\n        if (this.isDestroyed() || typeof this.successCallback !== 'function') {\n            return;\n        }\n\n        // Transform into \"mention selector\" format:\n        const collaboratorSelectorItems: SelectorItems<UserMini | GroupMini> = data.entries.map(\n            (collab: UserMini | GroupMini) => {\n                let item;\n                if (collab.type === 'group') {\n                    item = collab; // flow needs assignment to happen after type refinement\n                } else {\n                    item = collab;\n                    item.email = item.login; // transform user object\n                }\n                return {\n                    id: collab.id,\n                    name: collab.name,\n                    item,\n                };\n            },\n        );\n\n        this.successCallback({ ...data, entries: collaboratorSelectorItems });\n    };\n\n    /**\n     * API for fetching collaborators on a file\n     *\n     * @param {string} id - the file id\n     * @param {Function} successCallback - the success callback\n     * @param {Function} errorCallback - the error callback\n     * @param {Object} requestData - any additional request data\n     * @param {number} limit - the max number of collaborators to return\n     * @returns {void}\n     */\n    getFileCollaborators(\n        id: string,\n        successCallback: ({ entries: Array<SelectorItem<UserMini | GroupMini>>, next_marker: ?string }) => void,\n        errorCallback: ElementsErrorCallback,\n        requestData: Object = {},\n        limit: number = DEFAULT_MAX_COLLABORATORS,\n    ): void {\n        // NOTE: successCallback is called with the result\n        // of this.successHandler, not the API response!\n        this.markerGet({\n            id,\n            limit,\n            successCallback,\n            errorCallback,\n            requestData,\n        });\n    }\n\n    /**\n     * Fetches file @mention's\n     *\n     * @oaram {string} fileId\n     * @param {Function} successCallback\n     * @param {Function} errorCallback\n     * @param {string} searchStr - Search string to filter file collaborators by\n     * @param {Object} [options]\n     * @param {boolean} [options.includeGroups] - return groups as well as users\n     * @return {void}\n     */\n    getCollaboratorsWithQuery = (\n        fileId: string,\n        successCallback: ({ entries: Array<SelectorItem<UserMini | GroupMini>>, next_marker: ?string }) => void,\n        errorCallback: ElementsErrorCallback,\n        searchStr: string,\n        { includeGroups = false }: { includeGroups: boolean } = {},\n    ) => {\n        // Do not fetch without filter\n        if (!searchStr || searchStr.trim() === '') {\n            return;\n        }\n\n        this.getFileCollaborators(fileId, successCallback, errorCallback, {\n            filter_term: searchStr,\n            include_groups: includeGroups,\n            include_uploader_collabs: false,\n        });\n    };\n}\n\nexport default FileCollaborators;\n"],"file":"FileCollaborators.js"}