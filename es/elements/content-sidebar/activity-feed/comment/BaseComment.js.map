{"version":3,"sources":["../../../../../src/elements/content-sidebar/activity-feed/comment/BaseComment.js"],"names":["React","classNames","noop","TetherComponent","FormattedMessage","ActivityError","ActivityMessage","ActivityStatus","ActivityTimestamp","Avatar","Checkmark16","CommentForm","CreateReply","DeleteConfirmation","IconAnnotation","LoadingIndicator","Media","messages","Pencil16","RepliesToggle","Trash16","UserLink","X16","ACTIVITY_TARGETS","COMMENT_STATUS_OPEN","COMMENT_STATUS_RESOLVED","PLACEHOLDER_USER","MenuItem","BaseComment","annotationActivityLink","created_at","created_by","currentUser","error","getAvatarUrl","getMentionWithQuery","getUserProfileUrl","hasReplies","id","isDisabled","isPending","isRepliesLoading","mentionSelectorContacts","modified_at","onAnnotationEdit","onCommentEdit","onDelete","onHideReplies","onReplyCreate","onSelect","onShowReplies","permissions","replies","repliesTotalCount","status","tagged_message","translatedTaggedMessage","translations","useState","isConfirmingDelete","setIsConfirmingDelete","isEditing","setIsEditing","isInputOpen","setIsInputOpen","handleDeleteConfirm","handleDeleteCancel","handleDeleteClick","handleEditClick","handleMenuClose","commentFormFocusHandler","commentFormCancelHandler","commentFormSubmitHandler","handleMessageUpdate","messageID","text","hasMention","handleStatusUpdate","selectedStatus","onEdit","canDelete","can_delete","canEdit","can_edit","canResolve","can_resolve","createdAtTimestamp","Date","getTime","createdByUser","isEdited","undefined","isMenuVisible","isResolved","commentProps","annotationBadge","to","attachment","onMenuOpen","onMenuClose","COMMENT_OPTIONS","COMMENT_OPTIONS_EDIT","commentUnresolveMenuItem","commentResolveMenuItem","commentEditMenuItem","COMMENT_OPTIONS_DELETE","commentDeleteMenuItem","commentDeletePrompt","PROFILE","name","Replies","isParentPending","onReplySelect","showReplyForm","setShowReplyForm","getReplyPermissions","reply","handleNewReplyButton","handleCancelNewReply","handleSubmitNewReply","replyCreate","index","length","map","type"],"mappings":"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","sourcesContent":["// @flow\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport noop from 'lodash/noop';\nimport TetherComponent from 'react-tether';\nimport { FormattedMessage } from 'react-intl';\nimport ActivityError from '../common/activity-error';\nimport ActivityMessage from '../common/activity-message';\nimport ActivityStatus from '../common/activity-status';\nimport ActivityTimestamp from '../common/activity-timestamp';\nimport Avatar from '../Avatar';\nimport Checkmark16 from '../../../../icon/line/Checkmark16';\nimport CommentForm from '../comment-form';\nimport CreateReply from './CreateReply';\nimport DeleteConfirmation from '../common/delete-confirmation';\nimport IconAnnotation from '../../../../icons/two-toned/IconAnnotation';\nimport LoadingIndicator from '../../../../components/loading-indicator';\nimport Media from '../../../../components/media';\nimport messages from './messages';\nimport Pencil16 from '../../../../icon/line/Pencil16';\nimport RepliesToggle from './RepliesToggle';\nimport Trash16 from '../../../../icon/line/Trash16';\nimport UserLink from '../common/user-link';\nimport X16 from '../../../../icon/fill/X16';\nimport { ACTIVITY_TARGETS } from '../../../common/interactionTargets';\nimport { COMMENT_STATUS_OPEN, COMMENT_STATUS_RESOLVED, PLACEHOLDER_USER } from '../../../../constants';\nimport { MenuItem } from '../../../../components/menu';\nimport { type OnAnnotationEdit, type OnCommentEdit } from './types';\nimport type {\n    ActionItemError,\n    BoxCommentPermission,\n    FeedItemStatus,\n    Comment as CommentType,\n} from '../../../../common/types/feed';\n\nimport type { GetAvatarUrlCallback, GetProfileUrlCallback } from '../../../common/flowTypes';\nimport type { SelectorItems, User } from '../../../../common/types/core';\nimport type { Translations } from '../../flowTypes';\n\nimport './BaseComment.scss';\nimport './Replies.scss';\nimport './Comment.scss';\n\nexport type BaseCommentProps = {\n    annotationActivityLink?: React.Element<any>,\n    created_at: string | number,\n    created_by: User,\n    currentUser?: User,\n    error?: ActionItemError,\n    getAvatarUrl: GetAvatarUrlCallback,\n    getMentionWithQuery?: Function,\n    getUserProfileUrl?: GetProfileUrlCallback,\n    hasReplies?: boolean,\n    id: string,\n    isDisabled?: boolean,\n    isPending?: boolean,\n    isRepliesLoading?: boolean,\n    mentionSelectorContacts?: SelectorItems<>,\n    modified_at?: string | number,\n    onAnnotationEdit?: OnAnnotationEdit,\n    onCommentEdit: OnCommentEdit,\n    onDelete: ({ id: string, permissions?: BoxCommentPermission }) => any,\n    onHideReplies?: (shownReplies: CommentType[]) => void,\n    onReplyCreate?: (reply: string) => void,\n    onSelect: (isSelected: boolean) => void,\n    onShowReplies?: () => void,\n    permissions: BoxCommentPermission,\n    replies?: CommentType[],\n    repliesTotalCount?: number,\n    status?: FeedItemStatus,\n    tagged_message: string,\n    translatedTaggedMessage?: string,\n    translations?: Translations,\n};\n\nexport const BaseComment = ({\n    annotationActivityLink,\n    created_at,\n    created_by,\n    currentUser,\n    error,\n    getAvatarUrl,\n    getMentionWithQuery,\n    getUserProfileUrl,\n    hasReplies = false,\n    id,\n    isDisabled,\n    isPending = false,\n    isRepliesLoading = false,\n    mentionSelectorContacts,\n    modified_at,\n    onAnnotationEdit,\n    onCommentEdit,\n    onDelete,\n    onHideReplies,\n    onReplyCreate,\n    onSelect,\n    onShowReplies,\n    permissions = {},\n    replies = [],\n    repliesTotalCount = 0,\n    status,\n    tagged_message = '',\n    translatedTaggedMessage,\n    translations,\n}: BaseCommentProps) => {\n    const [isConfirmingDelete, setIsConfirmingDelete] = React.useState<boolean>(false);\n    const [isEditing, setIsEditing] = React.useState<boolean>(false);\n    const [isInputOpen, setIsInputOpen] = React.useState<boolean>(false);\n\n    const handleDeleteConfirm = (): void => {\n        onDelete({ id, permissions });\n        onSelect(false);\n    };\n\n    const handleDeleteCancel = (): void => {\n        setIsConfirmingDelete(false);\n        onSelect(false);\n    };\n\n    const handleDeleteClick = (): void => {\n        setIsConfirmingDelete(true);\n        onSelect(true);\n    };\n\n    const handleEditClick = (): void => {\n        setIsEditing(true);\n        setIsInputOpen(true);\n        onSelect(true);\n    };\n\n    const handleMenuClose = (): void => {\n        if (isConfirmingDelete || isEditing || isInputOpen) {\n            return;\n        }\n        onSelect(false);\n    };\n\n    const commentFormFocusHandler = (): void => {\n        setIsInputOpen(true);\n        onSelect(true);\n    };\n\n    const commentFormCancelHandler = (): void => {\n        setIsInputOpen(false);\n        setIsEditing(false);\n        onSelect(false);\n    };\n\n    const commentFormSubmitHandler = (): void => {\n        setIsInputOpen(false);\n        setIsEditing(false);\n        onSelect(false);\n    };\n\n    const handleMessageUpdate = ({ id: messageID, text, hasMention }) => {\n        // Since we have to pass onCommentEdit through annotations (to Replies), onAnnotationEdit essentially overrides onCommentEdit\n        if (onAnnotationEdit) {\n            onAnnotationEdit({ id: messageID, text, permissions });\n        } else if (onCommentEdit) {\n            onCommentEdit({\n                id: messageID,\n                text,\n                hasMention,\n                permissions,\n            });\n        }\n        commentFormSubmitHandler();\n    };\n\n    const handleStatusUpdate = (selectedStatus: FeedItemStatus): void => {\n        if (onAnnotationEdit) {\n            onAnnotationEdit({ id, permissions });\n        } else if (onCommentEdit) {\n            onCommentEdit({ id, status: selectedStatus, hasMention: false, permissions });\n        }\n    };\n\n    // Since we have to pass onCommentEdit through annotations (to Replies), onAnnotationEdit essentially overrides onCommentEdit\n    const onEdit = onAnnotationEdit ?? onCommentEdit;\n\n    const canDelete = permissions.can_delete;\n    const canEdit = onEdit !== noop && permissions.can_edit;\n    const canResolve = onEdit !== noop && permissions.can_resolve;\n    const createdAtTimestamp = new Date(created_at).getTime();\n    const createdByUser = created_by || PLACEHOLDER_USER;\n    const isEdited = modified_at !== undefined && modified_at !== created_at;\n    const isMenuVisible = (canDelete || canEdit || canResolve) && !isPending;\n    const isResolved = status === COMMENT_STATUS_RESOLVED;\n    const commentProps = {\n        currentUser,\n        getUserProfileUrl,\n        getAvatarUrl,\n        getMentionWithQuery,\n        mentionSelectorContacts,\n        translations,\n    };\n\n    return (\n        // TODO: Change className to bcs-Comment once FF is removed\n        <div className=\"bcs-BaseComment\">\n            <Media\n                className={classNames('bcs-Comment-media', {\n                    'bcs-is-pending': isPending || error,\n                })}\n            >\n                <Media.Figure>\n                    <Avatar\n                        getAvatarUrl={getAvatarUrl}\n                        user={createdByUser}\n                        badgeIcon={\n                            annotationActivityLink && (\n                                <IconAnnotation title={<FormattedMessage {...messages.annotationBadge} />} />\n                            )\n                        }\n                    />\n                </Media.Figure>\n                <Media.Body>\n                    {isMenuVisible && (\n                        <TetherComponent\n                            attachment=\"top right\"\n                            className=\"bcs-Comment-deleteConfirmationModal\"\n                            constraints={[{ to: 'scrollParent', attachment: 'together' }]}\n                            targetAttachment=\"bottom right\"\n                        >\n                            <Media.Menu\n                                isDisabled={isConfirmingDelete}\n                                data-testid=\"comment-actions-menu\"\n                                dropdownProps={{\n                                    onMenuOpen: () => onSelect(true),\n                                    onMenuClose: handleMenuClose,\n                                }}\n                                menuProps={{\n                                    'data-resin-component': ACTIVITY_TARGETS.COMMENT_OPTIONS,\n                                }}\n                            >\n                                {canResolve && isResolved && (\n                                    <MenuItem\n                                        className=\"bcs-Comment-unresolveComment\"\n                                        data-resin-target={ACTIVITY_TARGETS.COMMENT_OPTIONS_EDIT}\n                                        data-testid=\"unresolve-comment\"\n                                        onClick={() => handleStatusUpdate(COMMENT_STATUS_OPEN)}\n                                    >\n                                        <X16 />\n                                        <FormattedMessage {...messages.commentUnresolveMenuItem} />\n                                    </MenuItem>\n                                )}\n                                {canResolve && !isResolved && (\n                                    <MenuItem\n                                        data-resin-target={ACTIVITY_TARGETS.COMMENT_OPTIONS_EDIT}\n                                        data-testid=\"resolve-comment\"\n                                        onClick={() => handleStatusUpdate(COMMENT_STATUS_RESOLVED)}\n                                    >\n                                        <Checkmark16 />\n                                        <FormattedMessage {...messages.commentResolveMenuItem} />\n                                    </MenuItem>\n                                )}\n                                {canEdit && (\n                                    <MenuItem\n                                        data-resin-target={ACTIVITY_TARGETS.COMMENT_OPTIONS_EDIT}\n                                        data-testid=\"edit-comment\"\n                                        onClick={handleEditClick}\n                                    >\n                                        <Pencil16 />\n                                        <FormattedMessage {...messages.commentEditMenuItem} />\n                                    </MenuItem>\n                                )}\n                                {canDelete && (\n                                    <MenuItem\n                                        data-resin-target={ACTIVITY_TARGETS.COMMENT_OPTIONS_DELETE}\n                                        data-testid=\"delete-comment\"\n                                        onClick={handleDeleteClick}\n                                    >\n                                        <Trash16 />\n                                        <FormattedMessage {...messages.commentDeleteMenuItem} />\n                                    </MenuItem>\n                                )}\n                            </Media.Menu>\n                            {isConfirmingDelete && (\n                                <DeleteConfirmation\n                                    data-resin-component={ACTIVITY_TARGETS.COMMENT_OPTIONS}\n                                    isOpen={isConfirmingDelete}\n                                    message={messages.commentDeletePrompt}\n                                    onDeleteCancel={handleDeleteCancel}\n                                    onDeleteConfirm={handleDeleteConfirm}\n                                />\n                            )}\n                        </TetherComponent>\n                    )}\n                    <div className=\"bcs-Comment-headline\">\n                        <UserLink\n                            data-resin-target={ACTIVITY_TARGETS.PROFILE}\n                            id={createdByUser.id}\n                            name={createdByUser.name}\n                            getUserProfileUrl={getUserProfileUrl}\n                        />\n                    </div>\n                    <div className=\"bcs-Comment-timestamp\">\n                        <ActivityTimestamp date={createdAtTimestamp} />\n                        {annotationActivityLink}\n                    </div>\n                    <ActivityStatus status={status} />\n                    {isEditing ? (\n                        <CommentForm\n                            isDisabled={isDisabled}\n                            className={classNames('bcs-Comment-editor', {\n                                'bcs-is-disabled': isDisabled,\n                            })}\n                            updateComment={handleMessageUpdate}\n                            isOpen={isInputOpen}\n                            // $FlowFixMe\n                            user={currentUser}\n                            onCancel={commentFormCancelHandler}\n                            onFocus={commentFormFocusHandler}\n                            isEditing={isEditing}\n                            entityId={id}\n                            tagged_message={tagged_message}\n                            getAvatarUrl={getAvatarUrl}\n                            mentionSelectorContacts={mentionSelectorContacts}\n                            getMentionWithQuery={getMentionWithQuery}\n                        />\n                    ) : (\n                        <ActivityMessage\n                            id={id}\n                            isEdited={isEdited && !isResolved}\n                            tagged_message={tagged_message}\n                            translatedTaggedMessage={translatedTaggedMessage}\n                            {...translations}\n                            translationFailed={error ? true : null}\n                            getUserProfileUrl={getUserProfileUrl}\n                        />\n                    )}\n                </Media.Body>\n            </Media>\n            {/* $FlowFixMe */}\n            {error ? <ActivityError {...error} /> : null}\n            {hasReplies && (\n                <Replies\n                    {...commentProps}\n                    isParentPending={isPending}\n                    isRepliesLoading={isRepliesLoading}\n                    onCommentEdit={onCommentEdit}\n                    onHideReplies={onHideReplies}\n                    onReplyCreate={onReplyCreate}\n                    onReplySelect={onSelect}\n                    onShowReplies={onShowReplies}\n                    replies={replies}\n                    repliesTotalCount={repliesTotalCount}\n                />\n            )}\n        </div>\n    );\n};\n\n// Added Replies to Comment file to avoid circular dependency warning\ntype RepliesProps = {\n    currentUser?: User,\n    getAvatarUrl: GetAvatarUrlCallback,\n    getMentionWithQuery?: (searchStr: string) => void,\n    getUserProfileUrl?: GetProfileUrlCallback,\n    isParentPending?: boolean,\n    isRepliesLoading?: boolean,\n    mentionSelectorContacts?: SelectorItems<>,\n    onCommentEdit: OnCommentEdit,\n    onHideReplies?: (shownReplies: CommentType[]) => void,\n    onReplyCreate?: (reply: string) => void,\n    onReplySelect?: (isSelected: boolean) => void,\n    onShowReplies?: () => void,\n    replies: CommentType[],\n    repliesTotalCount?: number,\n    translations?: Translations,\n};\n\nexport const Replies = ({\n    currentUser,\n    getAvatarUrl,\n    getMentionWithQuery,\n    getUserProfileUrl,\n    isParentPending = false,\n    isRepliesLoading = false,\n    mentionSelectorContacts,\n    onCommentEdit,\n    onReplyCreate,\n    onReplySelect = noop,\n    onShowReplies,\n    onHideReplies,\n    replies,\n    repliesTotalCount = 0,\n    translations,\n}: RepliesProps) => {\n    const [showReplyForm, setShowReplyForm] = React.useState(false);\n    const getReplyPermissions = (reply: CommentType): BoxCommentPermission => {\n        const { permissions: { can_delete = false, can_edit = false, can_resolve = false } = {} } = reply;\n        return {\n            can_delete,\n            can_edit,\n            can_resolve,\n        };\n    };\n\n    const handleNewReplyButton = () => {\n        setShowReplyForm(true);\n        onReplySelect(true);\n    };\n\n    const handleCancelNewReply = () => {\n        setShowReplyForm(false);\n        onReplySelect(false);\n    };\n\n    const handleSubmitNewReply = (reply: string, replyCreate: (reply: string) => void) => {\n        setShowReplyForm(false);\n        replyCreate(reply);\n    };\n\n    return (\n        <div className=\"bcs-Replies\">\n            {!!onShowReplies && !!onHideReplies && (\n                <RepliesToggle\n                    onHideReplies={index => onHideReplies([replies[index]])}\n                    onShowReplies={onShowReplies}\n                    repliesShownCount={replies.length}\n                    repliesTotalCount={repliesTotalCount}\n                />\n            )}\n            <div className=\"bcs-Replies-content\">\n                {isRepliesLoading && (\n                    <div className=\"bcs-Replies-loading\" data-testid=\"replies-loading\">\n                        <LoadingIndicator />\n                    </div>\n                )}\n                <ol className=\"bcs-Replies-list\">\n                    {replies.map(reply => {\n                        const { id, type } = reply;\n\n                        return (\n                            <li key={`${type}${id}`}>\n                                <BaseComment\n                                    {...reply}\n                                    currentUser={currentUser}\n                                    getAvatarUrl={getAvatarUrl}\n                                    getMentionWithQuery={getMentionWithQuery}\n                                    getUserProfileUrl={getUserProfileUrl}\n                                    isPending={isParentPending || reply.isPending}\n                                    mentionSelectorContacts={mentionSelectorContacts}\n                                    onCommentEdit={onCommentEdit}\n                                    onSelect={onReplySelect}\n                                    onDelete={noop}\n                                    permissions={getReplyPermissions(reply)}\n                                    translations={translations}\n                                />\n                            </li>\n                        );\n                    })}\n                </ol>\n            </div>\n            {!!onReplyCreate && (\n                <CreateReply\n                    getMentionWithQuery={getMentionWithQuery}\n                    isDisabled={isParentPending}\n                    mentionSelectorContacts={mentionSelectorContacts}\n                    onCancel={handleCancelNewReply}\n                    onClick={handleNewReplyButton}\n                    onFocus={() => onReplySelect(true)}\n                    onSubmit={reply => handleSubmitNewReply(reply, onReplyCreate)}\n                    showReplyForm={showReplyForm}\n                />\n            )}\n        </div>\n    );\n};\n"],"file":"BaseComment.js"}