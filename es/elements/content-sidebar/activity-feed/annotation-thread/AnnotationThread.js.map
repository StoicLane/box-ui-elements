{"version":3,"sources":["../../../../../src/elements/content-sidebar/activity-feed/annotation-thread/AnnotationThread.js"],"names":["React","debounce","classNames","IntlProvider","AnnotationThreadContent","AnnotationThreadCreate","useAnnotationThread","API","DEFAULT_COLLAB_DEBOUNCE","DEFAULT_HOSTNAME_API","AnnotationThread","annotationId","apiHost","cache","className","clientName","currentUser","eventEmitter","file","getUserProfileUrl","handleCancel","language","messages","onAnnotationCreate","onError","target","token","useState","mentionSelectorContacts","setMentionSelectorContacts","api","errorCallback","annotation","replies","isLoading","error","annotationActions","handleAnnotationCreate","handleAnnotationDelete","handleAnnotationEdit","handleAnnotationStatusChange","repliesActions","handleReplyEdit","handleReplyCreate","handleReplyDelete","getAvatarUrl","userId","getUsersAPI","getAvatarUrlWithAccessToken","id","getMentionContactsSuccessCallback","entries","getMentionWithQuery","searchStr","getFileCollaboratorsAPI","getCollaboratorsWithQuery"],"mappings":"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","sourcesContent":["/**\n * @flow\n * @file Annotation Thread Container\n * @author Box\n */\n\nimport React from 'react';\nimport debounce from 'lodash/debounce';\nimport classNames from 'classnames';\nimport { IntlProvider } from 'react-intl';\nimport type EventEmitter from 'events';\nimport AnnotationThreadContent from './AnnotationThreadContent';\nimport AnnotationThreadCreate from './AnnotationThreadCreate';\nimport useAnnotationThread from './useAnnotationThread';\nimport API from '../../../../api/APIFactory';\nimport { DEFAULT_COLLAB_DEBOUNCE, DEFAULT_HOSTNAME_API } from '../../../../constants';\n\nimport type APICache from '../../../../utils/Cache';\nimport type { BoxItem, SelectorItems, StringMap, Token, User } from '../../../../common/types/core';\nimport type { ElementOrigin, ElementsXhrError } from '../../../../common/types/api';\nimport type { Annotation, Target } from '../../../../common/types/annotations';\nimport type { GetProfileUrlCallback } from '../../../common/flowTypes';\n\nimport './AnnotationThread.scss';\n\ntype Props = {\n    annotationId?: string,\n    apiHost?: string,\n    cache?: APICache,\n    className?: string,\n    clientName: string,\n    currentUser: User,\n    eventEmitter: EventEmitter,\n    file: BoxItem,\n    getUserProfileUrl?: GetProfileUrlCallback,\n    handleCancel: () => void,\n    language?: string,\n    messages?: StringMap,\n    onAnnotationCreate: (annotation: Annotation) => void,\n    onError: (error: ElementsXhrError | Error, code: string, contextInfo?: Object, origin?: ElementOrigin) => void,\n    target: Target,\n    token: Token,\n};\n\nconst AnnotationThread = ({\n    annotationId,\n    apiHost = DEFAULT_HOSTNAME_API,\n    cache,\n    className = '',\n    clientName,\n    currentUser,\n    eventEmitter,\n    file,\n    getUserProfileUrl,\n    handleCancel,\n    language,\n    messages,\n    onAnnotationCreate,\n    onError,\n    target,\n    token,\n}: Props) => {\n    const [mentionSelectorContacts, setMentionSelectorContacts] = React.useState<SelectorItems<>>([]);\n\n    const api = new API({\n        apiHost,\n        cache,\n        clientName,\n        language,\n        token,\n    });\n\n    const {\n        annotation,\n        replies,\n        isLoading,\n        error,\n        annotationActions: {\n            handleAnnotationCreate,\n            handleAnnotationDelete,\n            handleAnnotationEdit,\n            handleAnnotationStatusChange,\n        },\n        repliesActions: { handleReplyEdit, handleReplyCreate, handleReplyDelete },\n    } = useAnnotationThread({\n        api,\n        annotationId,\n        currentUser,\n        errorCallback: onError,\n        eventEmitter,\n        file,\n        onAnnotationCreate,\n        target,\n    });\n\n    const getAvatarUrl = async (userId: string): Promise<?string> =>\n        api.getUsersAPI(false).getAvatarUrlWithAccessToken(userId, file.id);\n\n    const getMentionContactsSuccessCallback = ({ entries }: { entries: SelectorItems<> }): void => {\n        setMentionSelectorContacts(entries);\n    };\n\n    const getMentionWithQuery = debounce(searchStr => {\n        api.getFileCollaboratorsAPI(false).getCollaboratorsWithQuery(\n            file.id,\n            getMentionContactsSuccessCallback,\n            onError,\n            searchStr,\n        );\n    }, DEFAULT_COLLAB_DEBOUNCE);\n\n    return (\n        <div className={classNames('AnnotationThread', className)} data-testid=\"annotation-thread\">\n            <IntlProvider locale={language} messages={messages}>\n                {!annotationId ? (\n                    <AnnotationThreadCreate\n                        currentUser={currentUser}\n                        getAvatarUrl={getAvatarUrl}\n                        getMentionWithQuery={getMentionWithQuery}\n                        isPending={isLoading}\n                        mentionSelectorContacts={mentionSelectorContacts}\n                        onFormCancel={handleCancel}\n                        onFormSubmit={handleAnnotationCreate}\n                    />\n                ) : (\n                    <AnnotationThreadContent\n                        annotation={annotation}\n                        currentUser={currentUser}\n                        error={error}\n                        getAvatarUrl={getAvatarUrl}\n                        getMentionWithQuery={getMentionWithQuery}\n                        getUserProfileUrl={getUserProfileUrl}\n                        isLoading={isLoading}\n                        mentionSelectorContacts={mentionSelectorContacts}\n                        onAnnotationDelete={handleAnnotationDelete}\n                        onAnnotationEdit={handleAnnotationEdit}\n                        onAnnotationStatusChange={handleAnnotationStatusChange}\n                        onReplyCreate={handleReplyCreate}\n                        onReplyDelete={handleReplyDelete}\n                        onReplyEdit={handleReplyEdit}\n                        replies={replies}\n                    />\n                )}\n            </IntlProvider>\n        </div>\n    );\n};\n\nexport default AnnotationThread;\n"],"file":"AnnotationThread.js"}