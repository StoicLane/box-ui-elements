function _templateObject17() {
  var data = _taggedTemplateLiteral(["\n            pathname                            | isOpen   | current             | expectedCount\n            ", "                              | ", " | ", "             | ", "\n            ", "                       | ", "  | ", "             | ", "\n            ", "                      | ", " | ", "             | ", "\n            ", "                      | ", "  | ", "             | ", "\n            ", "                      | ", " | ", " | ", "\n            ", "                      | ", "  | ", " | ", "\n            ", "       | ", "  | ", " | ", "\n            ", " | ", "  | ", " | ", "\n            ", "                       | ", "  | ", " | ", "\n            ", "                              | ", "  | ", " | ", "\n        "]);

  _templateObject17 = function _templateObject17() {
    return data;
  };

  return data;
}

function _templateObject16() {
  var data = _taggedTemplateLiteral(["\n            fileVersionId | expectedCallCount\n            ", "      | ", "\n            ", "      | ", "\n        "]);

  _templateObject16 = function _templateObject16() {
    return data;
  };

  return data;
}

function _templateObject15() {
  var data = _taggedTemplateLiteral(["\n            activeAnnotationId | fileVersionId | location                                    | expectedPath                       | expectedState\n            ", "           | ", "      | ", "                        | ", " | ", "\n            ", "           | ", "  | ", "                        | ", " | ", "\n            ", "            | ", "      | ", "                        | ", "     | ", "\n            ", "            | ", "      | ", " | ", "     | ", "\n            ", "           | ", "      | ", " | ", " | ", "\n        "]);

  _templateObject15 = function _templateObject15() {
    return data;
  };

  return data;
}

function _templateObject14() {
  var data = _taggedTemplateLiteral(["\n            action                       | expectedIsPending\n            ", " | ", "\n            ", "   | ", "\n        "]);

  _templateObject14 = function _templateObject14() {
    return data;
  };

  return data;
}

function _templateObject13() {
  var data = _taggedTemplateLiteral(["\n            action                 | expectedIsPending\n            ", " | ", "\n            ", "   | ", "\n        "]);

  _templateObject13 = function _templateObject13() {
    return data;
  };

  return data;
}

function _templateObject12() {
  var data = _taggedTemplateLiteral(["\n            hasItems     | expectedAddCount\n            ", " | ", "\n            ", "        | ", "\n        "]);

  _templateObject12 = function _templateObject12() {
    return data;
  };

  return data;
}

function _templateObject11() {
  var data = _taggedTemplateLiteral(["\n            fileVersionId | annotationId | expectedPath\n            ", "      | ", "     | ", "\n            ", "      | ", " | ", "\n        "]);

  _templateObject11 = function _templateObject11() {
    return data;
  };

  return data;
}

function _templateObject10() {
  var data = _taggedTemplateLiteral(["\n            fileVersionId | annotationId | expectedCallCount\n            ", "  | ", "     | ", "\n            ", "      | ", "     | ", "\n            ", "      | ", "     | ", "\n            ", "      | ", " | ", "\n        "]);

  _templateObject10 = function _templateObject10() {
    return data;
  };

  return data;
}

function _templateObject9() {
  var data = _taggedTemplateLiteral(["\n            fileId   | expectedCount\n            ", " | ", "\n            ", " | ", "\n        "]);

  _templateObject9 = function _templateObject9() {
    return data;
  };

  return data;
}

function _templateObject8() {
  var data = _taggedTemplateLiteral(["\n            action\n            ", "\n            ", "\n        "]);

  _templateObject8 = function _templateObject8() {
    return data;
  };

  return data;
}

function _templateObject7() {
  var data = _taggedTemplateLiteral(["\n            action\n            ", "\n            ", "\n        "]);

  _templateObject7 = function _templateObject7() {
    return data;
  };

  return data;
}

function _templateObject6() {
  var data = _taggedTemplateLiteral(["\n            action\n            ", "\n            ", "\n        "]);

  _templateObject6 = function _templateObject6() {
    return data;
  };

  return data;
}

function _templateObject5() {
  var data = _taggedTemplateLiteral(["\n            action\n            ", "\n            ", "\n        "]);

  _templateObject5 = function _templateObject5() {
    return data;
  };

  return data;
}

function _templateObject4() {
  var data = _taggedTemplateLiteral(["\n            action\n            ", "\n            ", "\n        "]);

  _templateObject4 = function _templateObject4() {
    return data;
  };

  return data;
}

function _templateObject3() {
  var data = _taggedTemplateLiteral(["\n            annotation   | expectedCount\n            ", "        | ", "\n            ", " | ", "\n            ", "      | ", "\n        "]);

  _templateObject3 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2() {
  var data = _taggedTemplateLiteral(["\n            condition                                          | prevActiveAnnotationId | activeAnnotationId | isAnnotationsPath | expectedCount\n            ", "                   | ", "               | ", "           | ", "           | ", "\n            ", "                  | ", "               | ", "           | ", "           | ", "\n            ", "     | ", "               | ", "            | ", "           | ", "\n            ", " | ", "               | ", "            | ", "          | ", "\n            ", "   | ", "                | ", "           | ", "          | ", "\n            ", "       | ", "                | ", "           | ", "           | ", "\n        "]);

  _templateObject2 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject() {
  var data = _taggedTemplateLiteral(["\n            prevFileVersionId | fileVersionId | expectedCallCount\n            ", "          | ", "      | ", "\n            ", "          | ", "  | ", "\n            ", "          | ", "      | ", "\n        "]);

  _templateObject = function _templateObject() {
    return data;
  };

  return data;
}

function _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import * as React from 'react';
import { shallow } from 'enzyme';
import withSidebarAnnotations from '../withSidebarAnnotations';
import { Action } from '../../common/annotator-context/types';
import { FEED_ITEM_TYPE_VERSION } from '../../../constants';
describe('elements/content-sidebar/withSidebarAnnotations', function () {
  var TestComponent = function TestComponent(props) {
    return React.createElement("div", props);
  };

  var WrappedComponent = withSidebarAnnotations(TestComponent);
  var annotatorContextProps = {
    getAnnotationsMatchPath: jest.fn(),
    getAnnotationsPath: jest.fn()
  };
  var currentUser = {
    id: 'foo'
  };
  var file = {
    id: 'id',
    file_version: {
      id: '123'
    }
  };
  var feedAPI = {
    addAnnotation: jest.fn(),
    addPendingReply: jest.fn(),
    feedItems: jest.fn(),
    getCachedItems: jest.fn(),
    deleteAnnotation: jest.fn(),
    deleteFeedItem: jest.fn(),
    deleteReplyItem: jest.fn(),
    modifyFeedItemRepliesCountBy: jest.fn(),
    updateFeedItem: jest.fn(),
    updateReplyItem: jest.fn()
  };
  var api = {
    getFeedAPI: function getFeedAPI() {
      return feedAPI;
    }
  };

  var defaultProps = _objectSpread({
    api: api
  }, annotatorContextProps, {
    file: file
  });

  var getWrapper = function getWrapper(props) {
    return shallow(React.createElement(WrappedComponent, _extends({}, defaultProps, props)));
  };

  describe('constructor', function () {
    test('should call redirectDeeplinkedAnnotation', function () {
      getWrapper();
      expect(annotatorContextProps.getAnnotationsMatchPath).toHaveBeenCalledTimes(1);
    });
  });
  describe('componentDidUpdate', function () {
    test.each(_templateObject(), '122', '122', 0, '122', undefined, 0, '122', '123', 1)('should call updateActiveVersion if fileVersionId changes', function (_ref) {
      var prevFileVersionId = _ref.prevFileVersionId,
          fileVersionId = _ref.fileVersionId,
          expectedCallCount = _ref.expectedCallCount;
      var match = {
        params: {
          fileVersionId: fileVersionId
        }
      };
      var prevMatch = {
        params: {
          fileVersionId: prevFileVersionId
        }
      };
      var wrapper = getWrapper({
        location: 'foo'
      });
      var instance = wrapper.instance();
      instance.updateActiveVersion = jest.fn();
      annotatorContextProps.getAnnotationsMatchPath.mockReturnValueOnce(match).mockReturnValueOnce(prevMatch);
      wrapper.setProps({
        location: 'bar'
      });
      expect(instance.updateActiveVersion).toHaveBeenCalledTimes(expectedCallCount);
    });
    test.each(_templateObject2(), 'annotation ids are the same', '123', '123', true, 0, 'annotation ids are different', '123', '456', true, 1, 'annotation deselected on annotations path', '123', null, true, 1, 'annotation deselected not on annotations path', '123', null, false, 0, 'annotation selected not on annotations path', null, '123', false, 1, 'annotation selected on annotations path', null, '123', true, 1)('should call updateActiveAnnotation $expectedCount times if $condition', function (_ref2) {
      var prevActiveAnnotationId = _ref2.prevActiveAnnotationId,
          activeAnnotationId = _ref2.activeAnnotationId,
          isAnnotationsPath = _ref2.isAnnotationsPath,
          expectedCount = _ref2.expectedCount;
      var wrapper = getWrapper({
        annotatorState: {
          activeAnnotationId: prevActiveAnnotationId
        }
      });
      var instance = wrapper.instance();
      instance.updateActiveAnnotation = jest.fn();
      annotatorContextProps.getAnnotationsMatchPath.mockReturnValue(isAnnotationsPath);
      wrapper.setProps({
        annotatorState: {
          activeAnnotationId: activeAnnotationId,
          action: Action.SET_ACTIVE
        }
      });
      expect(instance.updateActiveAnnotation).toHaveBeenCalledTimes(expectedCount);
    });
    test.each(_templateObject3(), {}, 1, undefined, 0, null, 0)('should call addAnnotation $expectedCount times if annotation changed to $annotation', function (_ref3) {
      var annotation = _ref3.annotation,
          expectedCount = _ref3.expectedCount;
      var wrapper = getWrapper();
      wrapper.instance().addAnnotation = jest.fn();
      wrapper.setProps({
        annotatorState: {
          annotation: annotation,
          action: Action.CREATE_END
        }
      });
      expect(wrapper.instance().addAnnotation).toHaveBeenCalledTimes(expectedCount);
    });
    test.each(_templateObject4(), Action.UPDATE_START, Action.UPDATE_END)('should call updateAnnotation if given action = $action', function (_ref4) {
      var action = _ref4.action;
      var annotation = {
        id: '123',
        status: 'resolved'
      };
      var wrapper = getWrapper();
      var instance = wrapper.instance();
      instance.updateAnnotation = jest.fn();
      wrapper.setProps({
        annotatorState: {
          annotation: annotation,
          action: action
        }
      });
      expect(instance.updateAnnotation).toBeCalled();
    });
    test.each(_templateObject5(), Action.DELETE_START, Action.DELETE_END)('should call deleteAnnotation if given action = $action', function (_ref5) {
      var action = _ref5.action;
      var annotation = {
        id: '123'
      };
      var wrapper = getWrapper();
      var instance = wrapper.instance();
      instance.deleteAnnotation = jest.fn();
      wrapper.setProps({
        annotatorState: {
          annotation: annotation,
          action: action
        }
      });
      expect(instance.deleteAnnotation).toBeCalled();
    });
    test.each(_templateObject6(), Action.REPLY_CREATE_START, Action.REPLY_CREATE_END)('should call addAnnotationReply if given action = $action', function (_ref6) {
      var action = _ref6.action;
      var annotation = {
        id: '123'
      };
      var annotationReply = {
        id: '456',
        tagged_message: 'abc'
      };
      var wrapper = getWrapper();
      var instance = wrapper.instance();
      instance.addAnnotationReply = jest.fn();
      wrapper.setProps({
        annotatorState: {
          action: action,
          annotation: annotation,
          annotationReply: annotationReply
        }
      });
      expect(instance.addAnnotationReply).toBeCalled();
    });
    test.each(_templateObject7(), Action.REPLY_DELETE_START, Action.REPLY_DELETE_END)('should call deleteAnnotationReply if given action = $action', function (_ref7) {
      var action = _ref7.action;
      var annotation = {
        id: '123'
      };
      var annotationReply = {
        id: '456'
      };
      var wrapper = getWrapper();
      var instance = wrapper.instance();
      instance.deleteAnnotationReply = jest.fn();
      wrapper.setProps({
        annotatorState: {
          action: action,
          annotation: annotation,
          annotationReply: annotationReply
        }
      });
      expect(instance.deleteAnnotationReply).toBeCalled();
    });
    test.each(_templateObject8(), Action.REPLY_UPDATE_START, Action.REPLY_UPDATE_END)('should call updateAnnotationReply if given action = $action', function (_ref8) {
      var action = _ref8.action;
      var annotation = {
        id: '123'
      };
      var annotationReply = {
        id: '456',
        tagged_message: 'abc'
      };
      var wrapper = getWrapper();
      var instance = wrapper.instance();
      instance.updateAnnotationReply = jest.fn();
      wrapper.setProps({
        annotatorState: {
          action: action,
          annotation: annotation,
          annotationReply: annotationReply
        }
      });
      expect(instance.updateAnnotationReply).toBeCalled();
    });
    test.each(_templateObject9(), '123', 0, '456', 1)('should call onVersionChange appropriately if file id changes to $fileId', function (_ref9) {
      var fileId = _ref9.fileId,
          expectedCount = _ref9.expectedCount;
      var onVersionChange = jest.fn();
      var wrapper = getWrapper({
        fileId: '123',
        onVersionChange: onVersionChange
      });
      wrapper.setProps({
        fileId: fileId
      });
      expect(onVersionChange).toHaveBeenCalledTimes(expectedCount);
    });
  });
  describe('redirectDeeplinkedAnnotation()', function () {
    var history = {
      replace: jest.fn()
    };
    var getAnnotationsMatchPath = jest.fn();
    var getAnnotationsPath = jest.fn();
    beforeEach(function () {
      jest.resetAllMocks();
    });
    test.each(_templateObject10(), undefined, '987', 0, '123', '987', 0, '124', '987', 1, '124', undefined, 1)('should call history.replace appropriately if router location annotationId=$annotationId and fileVersionId=$fileVersionId', function (_ref10) {
      var annotationId = _ref10.annotationId,
          fileVersionId = _ref10.fileVersionId,
          expectedCallCount = _ref10.expectedCallCount;
      var wrapper = getWrapper({
        file: file,
        getAnnotationsMatchPath: getAnnotationsMatchPath,
        getAnnotationsPath: getAnnotationsPath,
        history: history
      });
      var instance = wrapper.instance();
      getAnnotationsMatchPath.mockReturnValue({
        params: {
          annotationId: annotationId,
          fileVersionId: fileVersionId
        }
      });
      instance.redirectDeeplinkedAnnotation();
      expect(history.replace).toHaveBeenCalledTimes(expectedCallCount);
    });
    test.each(_templateObject11(), '124', '987', '/activity/annotations/123/987', '124', undefined, '/activity/annotations/123')('should call history.replace with $expectedPath', function (_ref11) {
      var fileVersionId = _ref11.fileVersionId,
          annotationId = _ref11.annotationId,
          expectedPath = _ref11.expectedPath;
      var wrapper = getWrapper({
        file: file,
        getAnnotationsMatchPath: getAnnotationsMatchPath,
        getAnnotationsPath: getAnnotationsPath,
        history: history
      });
      var instance = wrapper.instance();
      getAnnotationsMatchPath.mockReturnValue({
        params: {
          annotationId: annotationId,
          fileVersionId: fileVersionId
        }
      });
      getAnnotationsPath.mockReturnValue(expectedPath);
      instance.redirectDeeplinkedAnnotation();
      expect(history.replace).toHaveBeenCalledWith(expectedPath);
    });
  });
  describe('addAnnotation()', function () {
    beforeEach(function () {
      annotatorContextProps.getAnnotationsMatchPath.mockReturnValueOnce({
        params: {
          fileVersionId: '123'
        }
      });
    });
    test('should throw if no user', function () {
      var instance = getWrapper({
        annotatorState: {
          meta: {
            requestId: '123'
          }
        }
      }).instance();
      expect(function () {
        return instance.addAnnotation();
      }).toThrow('Bad box user!');
    });
    test('should do nothing if meta or requestId is not present', function () {
      var instance = getWrapper().instance();
      instance.addAnnotation(); // Only call to getAnnotationsMatchPath comes in the constructor, the one in addAnnotation should not occur

      expect(annotatorContextProps.getAnnotationsMatchPath).toHaveBeenCalledTimes(1);
    });
    test.each(_templateObject12(), undefined, 0, [], 1)('should add the annotation to the feed cache accordingly if the cache items is $hasItems', function (_ref12) {
      var hasItems = _ref12.hasItems,
          expectedAddCount = _ref12.expectedAddCount;
      var annotatorStateMock = {
        meta: {
          requestId: '123'
        }
      };
      var wrapper = getWrapper({
        annotatorState: annotatorStateMock,
        currentUser: currentUser
      });
      var instance = wrapper.instance();
      feedAPI.getCachedItems.mockReturnValueOnce({
        items: hasItems
      });
      instance.addAnnotation();
      expect(feedAPI.addAnnotation).toHaveBeenCalledTimes(expectedAddCount);
    });
  });
  describe('addAnnotationReply()', function () {
    test('should add appropriate reply into the feed given action = reply_create_start', function () {
      var annotation = {
        id: '123'
      };
      var annotationReply = {
        tagged_message: 'abc'
      };
      var requestId = 'comment_456';
      var annotatorStateMock = {
        action: Action.REPLY_CREATE_START,
        annotation: annotation,
        annotationReply: annotationReply,
        meta: {
          requestId: requestId
        }
      };
      var wrapper = getWrapper({
        annotatorState: annotatorStateMock,
        currentUser: currentUser
      });
      var instance = wrapper.instance();
      instance.addAnnotationReply();

      var expectedReplyData = _objectSpread({}, annotationReply, {
        id: requestId
      });

      expect(feedAPI.addPendingReply).toBeCalledWith(annotation.id, currentUser, expectedReplyData);
    });
    test('should update appropriate annotation and its reply in the feed given action = reply_create_end', function () {
      feedAPI.getCachedItems.mockReturnValueOnce({
        items: [{
          id: '123',
          replies: [{
            id: 'comment_456',
            tagged_message: 'abc'
          }],
          total_reply_count: 2
        }]
      });
      var annotation = {
        id: '123'
      };
      var annotationReply = {
        id: '456',
        tagged_message: 'abc'
      };
      var requestId = 'comment_456';
      var annotatorStateMock = {
        action: Action.REPLY_CREATE_END,
        annotation: annotation,
        annotationReply: annotationReply,
        meta: {
          requestId: requestId
        }
      };
      var wrapper = getWrapper({
        annotatorState: annotatorStateMock,
        currentUser: currentUser
      });
      var instance = wrapper.instance();
      instance.addAnnotationReply();

      var expectedReplyData = _objectSpread({}, annotationReply, {
        isPending: false
      });

      expect(feedAPI.modifyFeedItemRepliesCountBy).toBeCalledWith(annotation.id, 1);
      expect(feedAPI.updateReplyItem).toBeCalledWith(expectedReplyData, annotation.id, requestId);
    });
  });
  describe('deleteAnnotation()', function () {
    test('should change appropriate annotation to pending when action = delete_start', function () {
      var annotation = {
        id: '123'
      };
      var annotatorStateMock = {
        annotation: annotation,
        action: Action.DELETE_START
      };
      var wrapper = getWrapper({
        annotatorState: annotatorStateMock
      });
      var instance = wrapper.instance();
      instance.deleteAnnotation();
      expect(feedAPI.updateFeedItem).toBeCalledWith({
        isPending: true
      }, annotation.id);
    });
    test('should remove appropriate annotation from feed when action = delete_end', function () {
      var annotation = {
        id: '123'
      };
      var annotatorStateMock = {
        annotation: annotation,
        action: Action.DELETE_END
      };
      var wrapper = getWrapper({
        annotatorState: annotatorStateMock
      });
      var instance = wrapper.instance();
      instance.deleteAnnotation();
      expect(feedAPI.deleteFeedItem).toBeCalledWith(annotation.id);
    });
  });
  describe('deleteAnnotationReply()', function () {
    test('should update appropriate reply in the feed given action = reply_delete_start', function () {
      var annotation = {
        id: '123'
      };
      var annotationReply = {
        id: '456'
      };
      var annotatorStateMock = {
        action: Action.REPLY_DELETE_START,
        annotation: annotation,
        annotationReply: annotationReply
      };
      var wrapper = getWrapper({
        annotatorState: annotatorStateMock
      });
      var instance = wrapper.instance();
      instance.deleteAnnotationReply();
      expect(feedAPI.updateReplyItem).toBeCalledWith({
        isPending: true
      }, annotation.id, annotationReply.id);
    });
    test('should update appropriate annotation if reply is currently not in the feed given action = reply_delete_end', function () {
      feedAPI.getCachedItems.mockReturnValueOnce({
        items: [{
          id: '123',
          replies: [{
            id: '999',
            tagged_message: 'abc'
          }],
          total_reply_count: 2
        }]
      });
      var annotation = {
        id: '123'
      };
      var annotationReply = {
        id: '456',
        tagged_message: 'abc'
      };
      var annotatorStateMock = {
        action: Action.REPLY_DELETE_END,
        annotation: annotation,
        annotationReply: annotationReply
      };
      var wrapper = getWrapper({
        annotatorState: annotatorStateMock
      });
      var instance = wrapper.instance();
      instance.deleteAnnotationReply();
      expect(feedAPI.modifyFeedItemRepliesCountBy).toBeCalledWith(annotation.id, -1);
    });
    test('should delete appropriate reply from the feed if it is currently in the feed given action = reply_delete_end', function () {
      feedAPI.getCachedItems.mockReturnValueOnce({
        items: [{
          id: '123',
          replies: [{
            id: '456',
            tagged_message: 'abc'
          }],
          total_reply_count: 2
        }]
      });
      var annotation = {
        id: '123'
      };
      var annotationReply = {
        id: '456',
        tagged_message: 'abc'
      };
      var annotatorStateMock = {
        action: Action.REPLY_DELETE_END,
        annotation: annotation,
        annotationReply: annotationReply
      };
      var wrapper = getWrapper({
        annotatorState: annotatorStateMock
      });
      var instance = wrapper.instance();
      instance.deleteAnnotationReply();
      expect(feedAPI.deleteReplyItem).toBeCalledWith(annotationReply.id, annotation.id);
      expect(feedAPI.modifyFeedItemRepliesCountBy).toBeCalledWith(annotation.id, -1);
    });
  });
  describe('updateAnnotation()', function () {
    test.each(_templateObject13(), Action.UPDATE_START, true, Action.UPDATE_END, false)('should update appropriate annotation in the feed given action = $action', function (_ref13) {
      var action = _ref13.action,
          expectedIsPending = _ref13.expectedIsPending;
      var annotation = {
        id: '123',
        status: 'resolved'
      };
      var annotatorStateMock = {
        annotation: annotation,
        action: action
      };
      var wrapper = getWrapper({
        annotatorState: annotatorStateMock
      });
      var instance = wrapper.instance();
      instance.updateAnnotation();

      var expectedAnnotationData = _objectSpread({}, annotation, {
        isPending: expectedIsPending
      });

      expect(feedAPI.updateFeedItem).toBeCalledWith(expectedAnnotationData, annotation.id);
    });
  });
  describe('updateAnnotationReply()', function () {
    test.each(_templateObject14(), Action.REPLY_UPDATE_START, true, Action.REPLY_UPDATE_END, false)('should update appropriate reply in the feed given action = $action', function (_ref14) {
      var action = _ref14.action,
          expectedIsPending = _ref14.expectedIsPending;
      var annotation = {
        id: '123',
        status: 'resolved'
      };
      var annotationReply = {
        id: '456',
        tagged_message: 'abc'
      };
      var annotatorStateMock = {
        annotation: annotation,
        annotationReply: annotationReply,
        action: action
      };
      var wrapper = getWrapper({
        annotatorState: annotatorStateMock
      });
      var instance = wrapper.instance();
      instance.updateAnnotationReply();

      var expectedReplyData = _objectSpread({}, annotationReply, {
        isPending: expectedIsPending
      });

      expect(feedAPI.updateReplyItem).toBeCalledWith(expectedReplyData, annotation.id, annotationReply.id);
    });
  });
  describe('updateActiveAnnotation()', function () {
    test.each(_templateObject15(), '234', '456', {
      pathname: '/'
    }, '/activity/annotations/456/234', {
      open: true
    }, '234', undefined, {
      pathname: '/'
    }, '/activity/annotations/123/234', {
      open: true
    }, null, '456', {
      pathname: '/'
    }, '/activity/annotations/456', undefined, null, '456', {
      pathname: '/',
      state: {
        foo: 'bar'
      }
    }, '/activity/annotations/456', {
      foo: 'bar'
    }, '234', '456', {
      pathname: '/',
      state: {
        foo: 'bar'
      }
    }, '/activity/annotations/456/234', {
      open: true
    })('should set location path based on match param fileVersionId=$fileVersionId and activeAnnotationId=$activeAnnotationId', function (_ref15) {
      var activeAnnotationId = _ref15.activeAnnotationId,
          fileVersionId = _ref15.fileVersionId,
          location = _ref15.location,
          expectedPath = _ref15.expectedPath,
          expectedState = _ref15.expectedState;
      annotatorContextProps.getAnnotationsMatchPath.mockReturnValue({
        params: {
          fileVersionId: fileVersionId
        }
      });
      annotatorContextProps.getAnnotationsPath.mockReturnValue(expectedPath);
      var annotatorState = {
        activeAnnotationId: activeAnnotationId
      };
      var history = {
        push: jest.fn(),
        replace: jest.fn()
      };
      var wrapper = getWrapper({
        annotatorState: annotatorState,
        history: history,
        location: location
      });
      var instance = wrapper.instance();
      instance.updateActiveAnnotation();
      expect(history.push).toHaveBeenCalledWith({
        pathname: expectedPath,
        state: expectedState
      });
    });
    test('should use the provided fileVersionId in the annotatorState if provided', function () {
      var annotatorState = {
        activeAnnotationFileVersionId: '456',
        activeAnnotationId: '123'
      };
      var history = {
        push: jest.fn(),
        replace: jest.fn()
      };
      var wrapper = getWrapper({
        annotatorState: annotatorState,
        history: history,
        location: {
          pathname: '/'
        }
      });
      var instance = wrapper.instance();
      instance.updateActiveAnnotation();
      expect(annotatorContextProps.getAnnotationsPath).toHaveBeenCalledWith('456', '123');
    });
    test('should fall back to the fileVersionId in the file if none other is provided', function () {
      var history = {
        push: jest.fn(),
        replace: jest.fn()
      };
      var wrapper = getWrapper({
        history: history,
        location: {
          pathname: '/'
        }
      });
      var instance = wrapper.instance();
      instance.updateActiveAnnotation();
      expect(annotatorContextProps.getAnnotationsPath).toHaveBeenCalledWith('123', undefined);
    });
  });
  describe('updateActiveVersion()', function () {
    var onVersionChange = jest.fn();
    var version = {
      type: FEED_ITEM_TYPE_VERSION,
      id: '124'
    };
    beforeEach(function () {
      annotatorContextProps.getAnnotationsMatchPath.mockReturnValueOnce({
        params: {
          fileVersionId: '123'
        }
      });
    });
    test.each(_templateObject16(), '123', 0, '124', 1)('should onVersionChange $expectedCallCount times based on fileVersionId $fileVersionId', function (_ref16) {
      var fileVersionId = _ref16.fileVersionId,
          expectedCallCount = _ref16.expectedCallCount;
      var match = {
        params: {
          fileVersionId: fileVersionId
        }
      };
      var wrapper = getWrapper({
        file: file,
        onVersionChange: onVersionChange
      });
      var instance = wrapper.instance();
      annotatorContextProps.getAnnotationsMatchPath.mockReturnValueOnce(match);
      feedAPI.getCachedItems.mockReturnValueOnce({
        items: [version]
      });
      instance.updateActiveVersion();
      expect(onVersionChange).toHaveBeenCalledTimes(expectedCallCount);
    });
  });
  describe('refreshActivitySidebar()', function () {
    var history = {
      replace: jest.fn()
    };
    var sidebarPanelsRef = {
      refresh: jest.fn()
    };
    test.each(_templateObject17(), '/', false, null, 0, '/details', true, null, 0, '/activity', false, null, 0, '/activity', true, null, 0, '/activity', false, sidebarPanelsRef, 0, '/activity', true, sidebarPanelsRef, 1, '/activity/versions/12345', true, sidebarPanelsRef, 1, '/activity/versions/12345/67890', true, sidebarPanelsRef, 1, '/details', true, sidebarPanelsRef, 0, '/', true, sidebarPanelsRef, 0)('should refresh the sidebarPanels ref accordingly if pathname=$pathname, isOpen=$isOpen, current=$current', function (_ref17) {
      var current = _ref17.current,
          expectedCount = _ref17.expectedCount,
          isOpen = _ref17.isOpen,
          pathname = _ref17.pathname;
      var annotationUpdate = {
        id: '123',
        description: {
          message: 'text'
        }
      };
      var annotatorStateMock = {
        action: Action.UPDATE_END,
        annotation: annotationUpdate
      };
      var wrapper = getWrapper({
        annotatorState: annotatorStateMock,
        currentUser: currentUser,
        history: history,
        isOpen: isOpen,
        location: {
          pathname: pathname
        }
      });
      var instance = wrapper.instance();
      instance.sidebarPanels = {
        current: current
      };
      instance.updateAnnotation();
      expect(sidebarPanelsRef.refresh).toBeCalledTimes(expectedCount);
    });
  });
});