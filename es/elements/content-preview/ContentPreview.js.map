{"version":3,"sources":["../../../src/elements/content-preview/ContentPreview.js"],"names":["React","classNames","cloneDeep","flow","getProp","isEqual","noop","omit","setProp","throttle","uniqueid","Measure","withRouter","decode","makeResponsive","withNavRouter","Internationalize","AsyncLoad","TokenService","isInputElement","focus","getTypedFileId","withErrorBoundary","withLogger","PREVIEW_FIELDS_TO_FETCH","mark","withFeatureProvider","EVENT_JS_READY","ReloadNotification","API","PreviewHeader","PreviewMask","PreviewNavigation","withAnnotations","withAnnotatorContext","DEFAULT_HOSTNAME_API","DEFAULT_HOSTNAME_APP","DEFAULT_HOSTNAME_STATIC","DEFAULT_PREVIEW_VERSION","DEFAULT_LOCALE","DEFAULT_PATH_STATIC_PREVIEW","CLIENT_NAME_CONTENT_PREVIEW","ORIGIN_PREVIEW","ORIGIN_CONTENT_PREVIEW","ERROR_CODE_UNKNOWN","startAtTypes","page","InvalidIdError","Error","PREVIEW_LOAD_METRIC_EVENT","MARK_NAME_JS_READY","LoadableSidebar","loader","ContentPreview","props","createRef","canPrint","error","undefined","isLoading","isReloadNotificationVisible","isThumbnailSidebarOpen","rest","code","onError","setState","previewMetrics","logger","event_name","metrics","totalFetchFileTime","getTotalFileFetchTime","totalTime","value","file_info_time","onPreviewMetric","data","onLoad","collection","currentIndex","getFileIndex","filesToPrefetch","slice","previewTimeMetrics","loadData","totalPreviewMetrics","addFetchFileTimeToPreviewMetrics","time","focusPreview","preview","length","prefetch","handleCanPrint","advancedContentInsights","annotatorState","activeAnnotationId","enableThumbnailsSidebar","fileOptions","onAnnotatorEvent","onAnnotator","onContentInsightsEventReport","previewExperiences","showAnnotationsControls","tokenOrTokenFunction","token","state","file","selectedVersion","startAt","isPreviewLibraryLoaded","fileId","getFileId","currentFileId","fileOpts","typedId","getReadTokens","id","previewOptions","container","header","headerElement","experiences","showAnnotations","canViewAnnotations","showDownload","canDownload","showLoading","showProgress","skipServerUpdate","useHotkeys","Preview","global","Box","addListener","onPreviewLoad","onPreviewError","updateFileCache","show","Object","keys","stagedFile","initialState","getCurrentViewer","resize","fetchFileEndTime","performance","now","currentFile","isExistingFile","isWatermarked","file_version","sha1","fileError","errorCode","message","getPreview","viewer","isLoaded","isDestroyed","newIndex","navigateToIndex","onDownload","download","print","getViewer","isPreviewing","CLASS_NAVIGATION_VISIBILITY","clearTimeout","mouseMoveTimeoutID","previewContainer","classList","remove","allowNavigationArrows","add","setTimeout","event","consumed","key","target","onKeydown","nativeEvent","navigateLeft","navigateRight","preventDefault","stopPropagation","version","additionalVersionInfo","onVersionChange","updateVersionToCurrent","location","annotationFileVersionId","currentFileVersionId","currentPreviewFileVersionId","unit","type","emit","pageNumber","getThumbnail","apiHost","cache","language","requestInterceptor","responseInterceptor","sharedLink","sharedLinkPassword","api","clientName","prevFileIdProp","onReadyMetric","endMarkName","destroy","destroyPreview","shouldReset","onPreviewDestroy","removeAllListeners","loadStylesheet","loadScript","fetchFile","prevProps","prevState","prevContentInsightsOptions","prevPreviewExperiences","prevToken","hasFileIdChanged","hasTokenChanged","haveContentInsightsChanged","haveExperiencesChanged","shouldLoadPreview","loadPreview","updatePreviewToken","updateExperiences","updateContentInsightsOptions","shouldReload","updateToken","prevFile","prevSelectedVersion","prevSelectedVersionId","selectedVersionId","prevFileVersionId","fileVersionId","isPreviousCurrent","isSelectedCurrent","asset","staticHost","staticPath","previewLibraryVersion","path","suffix","endsWith","document","head","url","getBasePath","querySelector","link","createElement","rel","href","appendChild","previewScript","script","src","addEventListener","autoFocus","getInnerRef","activeElement","files","typedIds","map","cacheTokens","forEach","refreshCache","fetchFileStartTime","Math","round","rendering","conversion","preload","totalConversion","totalRendering","totalPreload","total","isFileDownloadable","isFileAnnotatable","hasViewAllPermissions","hasViewSelfPermissions","canAnnotate","successCallback","errorCallback","fetchOptions","getFileAPI","getFile","fetchFileSuccessCallback","fetchFileErrorCallback","fields","findIndex","item","index","onNavigate","fileOrId","contentSidebar","current","refresh","messages","className","contentSidebarProps","contentOpenWithProps","hasHeader","history","isLarge","isVeryLarge","logoUrl","onClose","measureRef","styleClassName","currentExtension","currentVersionId","onHeaderClose","onKeyDown","onMouseMove","containerRef","onResize","previewRef","getCache","handleAnnotationSelect","closeReloadNotification","loadFileFromStage","PureComponent","appHost","ContentPreviewComponent"],"mappings":"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","sourcesContent":["/**\n * @flow\n * @file Content Preview Component\n * @author Box\n */\n\nimport 'regenerator-runtime/runtime';\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport cloneDeep from 'lodash/cloneDeep';\nimport flow from 'lodash/flow';\nimport getProp from 'lodash/get';\nimport isEqual from 'lodash/isEqual';\nimport noop from 'lodash/noop';\nimport omit from 'lodash/omit';\nimport setProp from 'lodash/set';\nimport throttle from 'lodash/throttle';\nimport uniqueid from 'lodash/uniqueId';\nimport Measure from 'react-measure';\nimport { withRouter } from '../common/routing';\nimport type { ContextRouter } from 'react-router-dom';\nimport { decode } from '../../utils/keys';\nimport makeResponsive from '../common/makeResponsive';\nimport { withNavRouter } from '../common/nav-router';\nimport Internationalize from '../common/Internationalize';\nimport AsyncLoad from '../common/async-load';\nimport TokenService from '../../utils/TokenService';\nimport { isInputElement, focus } from '../../utils/dom';\nimport { getTypedFileId } from '../../utils/file';\nimport { withErrorBoundary } from '../common/error-boundary';\nimport { withLogger } from '../common/logger';\nimport { PREVIEW_FIELDS_TO_FETCH } from '../../utils/fields';\nimport { mark } from '../../utils/performance';\nimport { withFeatureProvider } from '../common/feature-checking';\nimport { EVENT_JS_READY } from '../common/logger/constants';\nimport ReloadNotification from './ReloadNotification';\nimport API from '../../api';\nimport PreviewHeader from './preview-header';\nimport PreviewMask from './PreviewMask';\nimport PreviewNavigation from './PreviewNavigation';\nimport {\n    withAnnotations,\n    withAnnotatorContext,\n} from '../common/annotator-context';\nimport {\n    DEFAULT_HOSTNAME_API,\n    DEFAULT_HOSTNAME_APP,\n    DEFAULT_HOSTNAME_STATIC,\n    DEFAULT_PREVIEW_VERSION,\n    DEFAULT_LOCALE,\n    DEFAULT_PATH_STATIC_PREVIEW,\n    CLIENT_NAME_CONTENT_PREVIEW,\n    ORIGIN_PREVIEW,\n    ORIGIN_CONTENT_PREVIEW,\n    ERROR_CODE_UNKNOWN,\n} from '../../constants';\nimport type { Annotation } from '../../common/types/feed';\nimport type { TargetingApi } from '../../features/targeting/types';\nimport type { ErrorType, AdditionalVersionInfo } from '../common/flowTypes';\nimport type { WithLoggerProps } from '../../common/types/logging';\nimport type { RequestOptions, ErrorContextProps, ElementsXhrError } from '../../common/types/api';\nimport type { StringMap, Token, BoxItem, BoxItemVersion } from '../../common/types/core';\nimport type { VersionChangeCallback } from '../content-sidebar/versions';\nimport type { FeatureConfig } from '../common/feature-checking';\nimport type APICache from '../../utils/Cache';\n\nimport '../common/fonts.scss';\nimport '../common/base.scss';\nimport './ContentPreview.scss';\n\ninterface WithAnnotatorContextProps {\n    annotatorState?: AnnotatorState;\n    emitActiveAnnotationChangeEvent?: (id: string) => void;\n    emitAnnotationRemoveEvent?: (id: string, isStartEvent?: boolean) => void;\n    emitAnnotationReplyCreateEvent?: (\n        reply: Object,\n        requestId: string,\n        annotationId: string,\n        isStartEvent?: boolean,\n    ) => void;\n    emitAnnotationReplyDeleteEvent?: (id: string, annotationId: string, isStartEvent?: boolean) => void;\n    emitAnnotationReplyUpdateEvent?: (reply: Object, annotationId: string, isStartEvent?: boolean) => void;\n    emitAnnotationUpdateEvent?: (annotation: Object, isStartEvent?: boolean) => void;\n    getAnnotationsMatchPath?: GetMatchPath;\n    getAnnotationsPath?: (fileVersionId?: string, annotationId?: string) => string;\n}\n\ntype WithAnnotationsProps = {\n    location?: Location;\n    onAnnotator: (annotator: Annotator) => void;\n    onError?: (error: Error, code: string, contextInfo?: Record<string, unknown>) => void;\n    onPreviewDestroy: (shouldReset?: boolean) => void;\n};\n\ntype StartAt = {\n    unit: 'pages' | 'seconds',\n    value: number,\n};\n\ntype Props = {\n    advancedContentInsights: {\n        isActive: boolean,\n        ownerEId: number,\n        userId: number,\n    },\n    apiHost: string,\n    appHost: string,\n    autoFocus: boolean,\n    boxAnnotations?: Object,\n    cache?: APICache,\n    canDownload?: boolean,\n    className: string,\n    collection: Array<string | BoxItem>,\n    contentOpenWithProps: ContentOpenWithProps,\n    contentSidebarProps: ContentSidebarProps,\n    enableThumbnailsSidebar: boolean,\n    features?: FeatureConfig,\n    fileId?: string,\n    fileOptions?: Object,\n    getInnerRef: () => ?HTMLElement,\n    hasHeader?: boolean,\n    isLarge: boolean,\n    isVeryLarge?: boolean,\n    language: string,\n    logoUrl?: string,\n    measureRef: Function,\n    messages?: StringMap,\n    onAnnotator: Function,\n    onAnnotatorEvent: Function,\n    onClose?: Function,\n    onContentInsightsEventReport: Function,\n    onDownload: Function,\n    onLoad: Function,\n    onNavigate: Function,\n    onVersionChange: VersionChangeCallback,\n    previewExperiences?: {\n        [name: string]: TargetingApi,\n    },\n    previewLibraryVersion: string,\n    requestInterceptor?: Function,\n    responseInterceptor?: Function,\n    sharedLink?: string,\n    sharedLinkPassword?: string,\n    showAnnotations?: boolean,\n    showAnnotationsControls?: boolean,\n    staticHost: string,\n    staticPath: string,\n    token: Token,\n    useHotkeys: boolean,\n} & ErrorContextProps &\n    WithLoggerProps &\n    WithAnnotationsProps &\n    WithAnnotatorContextProps &\n    ContextRouter;\n\ntype State = {\n    canPrint?: boolean,\n    currentFileId?: string,\n    error?: ErrorType,\n    file?: BoxItem,\n    isLoading: boolean,\n    isReloadNotificationVisible: boolean,\n    isThumbnailSidebarOpen: boolean,\n    prevFileIdProp?: string, // the previous value of the \"fileId\" prop. Needed to implement getDerivedStateFromProps\n    selectedVersion?: BoxItemVersion,\n    startAt?: StartAt,\n};\n\n// Emitted by preview's 'load' event\ntype PreviewTimeMetrics = {\n    conversion: number,\n    preload?: number,\n    rendering: number,\n    total: number,\n};\n\n// Emitted by preview's 'preview_metric' event\ntype PreviewMetrics = {\n    browser_name: string,\n    client_version: string,\n    content_type: string, // Sum of all available load times.\n    convert_time: number,\n    download_response_time: number,\n    error?: Object,\n    event_name?: string,\n    extension: string,\n    file_id: string,\n    file_info_time: number,\n    file_version_id: string,\n    full_document_load_time: number,\n    locale: string,\n    logger_session_id: string,\n    rep_type: string,\n    timestamp: string,\n    value: number,\n};\n\ntype PreviewLibraryError = {\n    error: ErrorType,\n};\n\nconst startAtTypes = {\n    page: 'pages',\n};\nconst InvalidIdError = new Error('Invalid id for Preview!');\nconst PREVIEW_LOAD_METRIC_EVENT = 'load';\nconst MARK_NAME_JS_READY = `${ORIGIN_CONTENT_PREVIEW}_${EVENT_JS_READY}`;\n\nmark(MARK_NAME_JS_READY);\n\nconst LoadableSidebar = AsyncLoad({\n    loader: () => import(/* webpackMode: \"lazy\", webpackChunkName: \"content-sidebar\" */ '../content-sidebar'),\n});\n\nclass ContentPreview extends React.PureComponent<Props, State> {\n    id: string;\n\n    props: Props;\n\n    state: State;\n\n    preview: any;\n\n    api: API;\n\n    // Defines a generic type for ContentSidebar, since an import would interfere with code splitting\n    contentSidebar: { current: null | { refresh: Function } } = React.createRef();\n\n    previewContainer: ?HTMLDivElement;\n\n    mouseMoveTimeoutID: TimeoutID;\n\n    rootElement: HTMLElement;\n\n    stagedFile: ?BoxItem;\n\n    updateVersionToCurrent: ?() => void;\n\n    initialState: State = {\n        canPrint: false,\n        error: undefined,\n        isLoading: true,\n        isReloadNotificationVisible: false,\n        isThumbnailSidebarOpen: false,\n    };\n\n    static defaultProps = {\n        apiHost: DEFAULT_HOSTNAME_API,\n        appHost: DEFAULT_HOSTNAME_APP,\n        autoFocus: false,\n        canDownload: true,\n        className: '',\n        collection: [],\n        contentOpenWithProps: {},\n        contentSidebarProps: {},\n        enableThumbnailsSidebar: false,\n        hasHeader: false,\n        language: DEFAULT_LOCALE,\n        onAnnotator: noop,\n        onAnnotatorEvent: noop,\n        onContentInsightsEventReport: noop,\n        onDownload: noop,\n        onError: noop,\n        onLoad: noop,\n        onNavigate: noop,\n        onPreviewDestroy: noop,\n        onVersionChange: noop,\n        previewLibraryVersion: DEFAULT_PREVIEW_VERSION,\n        showAnnotations: false,\n        staticHost: DEFAULT_HOSTNAME_STATIC,\n        staticPath: DEFAULT_PATH_STATIC_PREVIEW,\n        useHotkeys: true,\n    };\n\n    /**\n     * @property {number}\n     */\n    fetchFileEndTime: ?number;\n\n    /**\n     * @property {number}\n     */\n    fetchFileStartTime: ?number;\n\n    /**\n     * [constructor]\n     *\n     * @return {ContentPreview}\n     */\n    constructor(props: Props) {\n        super(props);\n        const {\n            apiHost,\n            cache,\n            fileId,\n            language,\n            requestInterceptor,\n            responseInterceptor,\n            sharedLink,\n            sharedLinkPassword,\n            token,\n        } = props;\n\n        this.id = uniqueid('bcpr_');\n        this.api = new API({\n            apiHost,\n            cache,\n            clientName: CLIENT_NAME_CONTENT_PREVIEW,\n            language,\n            requestInterceptor,\n            responseInterceptor,\n            sharedLink,\n            sharedLinkPassword,\n            token,\n        });\n        this.state = {\n            ...this.initialState,\n            currentFileId: fileId,\n            // eslint-disable-next-line react/no-unused-state\n            prevFileIdProp: fileId,\n        };\n        const { logger } = props;\n        logger.onReadyMetric({\n            endMarkName: MARK_NAME_JS_READY,\n        });\n    }\n\n    /**\n     * Cleanup\n     *\n     * @return {void}\n     */\n    componentWillUnmount(): void {\n        // Don't destroy the cache while unmounting\n        this.api.destroy(false);\n        this.destroyPreview();\n    }\n\n    /**\n     * Cleans up the preview instance\n     */\n    destroyPreview(shouldReset: boolean = true) {\n        const { onPreviewDestroy } = this.props;\n        if (this.preview) {\n            this.preview.destroy();\n            this.preview.removeAllListeners();\n            this.preview = undefined;\n\n            onPreviewDestroy(shouldReset);\n        }\n    }\n\n    /**\n     * Destroys api instances with caches\n     *\n     * @private\n     * @return {void}\n     */\n    clearCache(): void {\n        this.api.destroy(true);\n    }\n\n    /**\n     * Once the component mounts, load Preview assets and fetch file info.\n     *\n     * @return {void}\n     */\n    componentDidMount(): void {\n        this.loadStylesheet();\n        this.loadScript();\n\n        this.fetchFile(this.state.currentFileId);\n        this.focusPreview();\n    }\n\n    static getDerivedStateFromProps(props: Props, state: State) {\n        const { fileId } = props;\n\n        if (fileId !== state.prevFileIdProp) {\n            return {\n                currentFileId: fileId,\n                prevFileIdProp: fileId,\n            };\n        }\n\n        return null;\n    }\n\n    /**\n     * After component updates, load Preview if appropriate.\n     *\n     * @return {void}\n     */\n    componentDidUpdate(prevProps: Props, prevState: State): void {\n        const { advancedContentInsights, previewExperiences, token } = this.props;\n        const {\n            advancedContentInsights: prevContentInsightsOptions,\n            previewExperiences: prevPreviewExperiences,\n            token: prevToken,\n        } = prevProps;\n        const { currentFileId } = this.state;\n        const hasFileIdChanged = prevState.currentFileId !== currentFileId;\n        const hasTokenChanged = prevToken !== token;\n        const haveContentInsightsChanged = !isEqual(prevContentInsightsOptions, advancedContentInsights);\n        const haveExperiencesChanged = prevPreviewExperiences !== previewExperiences;\n\n        if (hasFileIdChanged) {\n            this.destroyPreview();\n            this.setState({ isLoading: true, selectedVersion: undefined });\n            this.fetchFile(currentFileId);\n        } else if (this.shouldLoadPreview(prevState)) {\n            this.destroyPreview(false);\n            this.setState({ isLoading: true });\n            this.loadPreview();\n        } else if (hasTokenChanged) {\n            this.updatePreviewToken();\n        }\n\n        if (haveExperiencesChanged && this.preview && this.preview.updateExperiences) {\n            this.preview.updateExperiences(previewExperiences);\n        }\n\n        if (advancedContentInsights && haveContentInsightsChanged && this.preview?.updateContentInsightsOptions) {\n            this.preview.updateContentInsightsOptions(advancedContentInsights);\n        }\n    }\n\n    /**\n     * Updates the access token used by preview library\n     *\n     * @param {boolean} shouldReload - true if preview should be reloaded\n     */\n    updatePreviewToken(shouldReload: boolean = false) {\n        if (this.preview) {\n            this.preview.updateToken(this.props.token, shouldReload);\n        }\n    }\n\n    /**\n     * Returns whether or not preview should be loaded.\n     *\n     * @param {State} prevState - Previous state\n     * @return {boolean}\n     */\n    shouldLoadPreview(prevState: State): boolean {\n        const { file, selectedVersion }: State = this.state;\n        const { file: prevFile, selectedVersion: prevSelectedVersion }: State = prevState;\n        const prevSelectedVersionId = getProp(prevSelectedVersion, 'id');\n        const selectedVersionId = getProp(selectedVersion, 'id');\n        const prevFileVersionId = getProp(prevFile, 'file_version.id');\n        const fileVersionId = getProp(file, 'file_version.id');\n        let loadPreview = false;\n\n        if (selectedVersionId !== prevSelectedVersionId) {\n            const isPreviousCurrent = fileVersionId === prevSelectedVersionId || !prevSelectedVersionId;\n            const isSelectedCurrent = fileVersionId === selectedVersionId || !selectedVersionId;\n\n            // Load preview if the user has selected a non-current version of the file\n            loadPreview = !isPreviousCurrent || !isSelectedCurrent;\n        } else if (fileVersionId && prevFileVersionId) {\n            // Load preview if the file's current version ID has changed\n            loadPreview = fileVersionId !== prevFileVersionId;\n        } else {\n            // Load preview if file object has newly been populated in state\n            loadPreview = !prevFile && !!file;\n        }\n\n        return loadPreview;\n    }\n\n    /**\n     * Returns preview asset urls\n     *\n     * @return {string} base url\n     */\n    getBasePath(asset: string): string {\n        const { staticHost, staticPath, language, previewLibraryVersion }: Props = this.props;\n        const path: string = `${staticPath}/${previewLibraryVersion}/${language}/${asset}`;\n        const suffix: string = staticHost.endsWith('/') ? path : `/${path}`;\n        return `${staticHost}${suffix}`;\n    }\n\n    /**\n     * Determines if preview assets are loaded\n     *\n     * @return {boolean} true if preview is loaded\n     */\n    isPreviewLibraryLoaded(): boolean {\n        return !!global.Box && !!global.Box.Preview;\n    }\n\n    /**\n     * Loads external css by appending a <link> element\n     *\n     * @return {void}\n     */\n    loadStylesheet(): void {\n        const { head } = document;\n        const url: string = this.getBasePath('preview.css');\n\n        if (!head || head.querySelector(`link[rel=\"stylesheet\"][href=\"${url}\"]`)) {\n            return;\n        }\n\n        const link = document.createElement('link');\n        link.rel = 'stylesheet';\n        link.type = 'text/css';\n        link.href = url;\n        head.appendChild(link);\n    }\n\n    /**\n     * Loads external script by appending a <script> element\n     *\n     * @return {void}\n     */\n    loadScript(): void {\n        const { head } = document;\n        const url: string = this.getBasePath('preview.js');\n\n        if (!head || this.isPreviewLibraryLoaded()) {\n            return;\n        }\n\n        const previewScript = head.querySelector(`script[src=\"${url}\"]`);\n        if (previewScript) {\n            return;\n        }\n\n        const script = document.createElement('script');\n        script.src = url;\n        script.addEventListener('load', this.loadPreview);\n        head.appendChild(script);\n    }\n\n    /**\n     * Focuses the preview on load.\n     *\n     * @return {void}\n     */\n    focusPreview() {\n        const { autoFocus, getInnerRef }: Props = this.props;\n        if (autoFocus && !isInputElement(document.activeElement)) {\n            focus(getInnerRef());\n        }\n    }\n\n    /**\n     * Updates preview cache and prefetches a file\n     *\n     * @param {BoxItem} file - file to prefetch\n     * @return {void}\n     */\n    updatePreviewCacheAndPrefetch(file: BoxItem, token: Token): void {\n        if (!this.preview || !file || !file.id) {\n            return;\n        }\n\n        this.preview.updateFileCache([file]);\n        this.preview.prefetch({ fileId: file.id, token });\n    }\n\n    /**\n     * Gets the file id\n     *\n     * @param {string|BoxItem} file - box file or file id\n     * @return {string} file id\n     */\n    getFileId(file?: string | BoxItem): string {\n        if (typeof file === 'string') {\n            return file;\n        }\n\n        if (typeof file === 'object' && !!file.id) {\n            return file.id;\n        }\n\n        throw InvalidIdError;\n    }\n\n    /**\n     * Prefetches the next few preview files if any\n     *\n     * @param {Array<string|BoxItem>} files - files to prefetch\n     * @return {void}\n     */\n    async prefetch(files: Array<string | BoxItem>): Promise<void> {\n        const { token }: Props = this.props;\n        const typedIds: string[] = files.map(file => getTypedFileId(this.getFileId(file)));\n        await TokenService.cacheTokens(typedIds, token);\n        files.forEach(file => {\n            const fileId = this.getFileId(file);\n            this.fetchFile(fileId, noop, noop, {\n                refreshCache: false,\n            });\n        });\n    }\n\n    /**\n     * Calculates the total file fetch time\n     *\n     * @return {number} the total fetch time\n     */\n    getTotalFileFetchTime(): number {\n        if (!this.fetchFileStartTime || !this.fetchFileEndTime) {\n            return 0;\n        }\n\n        return Math.round(this.fetchFileEndTime - this.fetchFileStartTime);\n    }\n\n    /**\n     * Handler for 'preview_error' preview event\n     *\n     * @param {PreviewLibraryError} previewError - the error data emitted from preview\n     * @return {void}\n     */\n    onPreviewError = ({ error, ...rest }: PreviewLibraryError): void => {\n        const { code = ERROR_CODE_UNKNOWN } = error;\n        const { onError } = this.props;\n\n        // In case of error, there should be no thumbnail sidebar to account for\n        this.setState({ isLoading: false, isThumbnailSidebarOpen: false });\n\n        onError(\n            error,\n            code,\n            {\n                ...rest,\n                error,\n            },\n            ORIGIN_PREVIEW,\n        );\n    };\n\n    /**\n     * Event handler 'preview_metric' which also adds in the file fetch time if it's a load event\n     *\n     * @param {Object} previewMetrics - the object emitted by 'preview_metric'\n     * @return {void}\n     */\n    onPreviewMetric = (previewMetrics: PreviewMetrics): void => {\n        const { logger } = this.props;\n        const { event_name } = previewMetrics;\n        let metrics = {\n            ...previewMetrics,\n        };\n\n        // We need to add in the total file fetch time to the file_info_time and value (total)\n        // as preview does not do the files call\n        if (event_name === PREVIEW_LOAD_METRIC_EVENT) {\n            const totalFetchFileTime = this.getTotalFileFetchTime();\n            const totalTime = (previewMetrics.value || 0) + totalFetchFileTime;\n\n            // If an unnatural load time occurs or is invalid, don't log a load event\n            if (!totalTime) {\n                return;\n            }\n\n            metrics = {\n                ...previewMetrics,\n                file_info_time: totalFetchFileTime,\n                value: totalTime,\n            };\n        }\n\n        logger.onPreviewMetric(metrics);\n    };\n\n    /**\n     * Adds in the file fetch time to the preview metrics\n     *\n     * @param {Object} previewTimeMetrics - the preview time metrics\n     * @return {Object} the preview time metrics merged with the files call time\n     */\n    addFetchFileTimeToPreviewMetrics(previewTimeMetrics: PreviewTimeMetrics): PreviewTimeMetrics {\n        const totalFetchFileTime = this.getTotalFileFetchTime();\n        const { rendering, conversion, preload } = previewTimeMetrics;\n\n        // We need to add in the total file fetch time to the rendering and total as preview\n        // does not do the files call. In the case the file is in the process of\n        // being converted, we need to add to conversion instead of the render\n        let totalConversion = conversion;\n        let totalRendering = rendering;\n        let totalPreload = preload;\n        if (conversion) {\n            totalConversion += totalFetchFileTime;\n        } else {\n            totalRendering += totalFetchFileTime;\n        }\n\n        if (totalPreload) {\n            // Preload is optional, depending on file type\n            totalPreload += totalFetchFileTime;\n        }\n\n        const previewMetrics = {\n            conversion: totalConversion,\n            rendering: totalRendering,\n            total: totalRendering + totalConversion,\n            preload: totalPreload,\n        };\n\n        return previewMetrics;\n    }\n\n    /**\n     * onLoad function for preview\n     *\n     * @return {void}\n     */\n    onPreviewLoad = (data: Object): void => {\n        const { onLoad, collection }: Props = this.props;\n        const currentIndex = this.getFileIndex();\n        const filesToPrefetch = collection.slice(currentIndex + 1, currentIndex + 5);\n        const previewTimeMetrics = getProp(data, 'metrics.time');\n        let loadData = data;\n\n        if (previewTimeMetrics) {\n            const totalPreviewMetrics = this.addFetchFileTimeToPreviewMetrics(previewTimeMetrics);\n            loadData = {\n                ...loadData,\n                metrics: {\n                    ...loadData.metrics,\n                    time: totalPreviewMetrics,\n                },\n            };\n        }\n\n        onLoad(loadData);\n\n        this.setState({ isLoading: false });\n        this.focusPreview();\n\n        if (this.preview && filesToPrefetch.length) {\n            this.prefetch(filesToPrefetch);\n        }\n\n        this.handleCanPrint();\n    };\n\n    /**\n     * Returns whether file can be downloaded based on file properties, permissions, and user-defined options.\n     *\n     * @return {boolean}\n     */\n    canDownload(): boolean {\n        const { canDownload }: Props = this.props;\n        const { file }: State = this.state;\n        const isFileDownloadable =\n            getProp(file, 'permissions.can_download', false) && getProp(file, 'is_download_available', false);\n        return isFileDownloadable && !!canDownload;\n    }\n\n    /**\n     * Returns whether file can be annotated based on permissions\n     *\n     * @return {boolean}\n     */\n    canAnnotate(): boolean {\n        const { showAnnotations }: Props = this.props;\n        const { file }: State = this.state;\n        const isFileAnnotatable = getProp(file, 'permissions.can_annotate', false);\n        return !!showAnnotations && isFileAnnotatable;\n    }\n\n    /**\n     * Returns whether a preview should render annotations based on permissions\n     *\n     * @return {boolean}\n     */\n    canViewAnnotations(): boolean {\n        const { showAnnotations }: Props = this.props;\n        const { file }: State = this.state;\n        const hasViewAllPermissions = getProp(file, 'permissions.can_view_annotations_all', false);\n        const hasViewSelfPermissions = getProp(file, 'permissions.can_view_annotations_self', false);\n        return !!showAnnotations && (this.canAnnotate() || hasViewAllPermissions || hasViewSelfPermissions);\n    }\n\n    handleCanPrint() {\n        const preview = this.getPreview();\n        this.setState({ canPrint: !!preview && (!preview.canPrint || preview.canPrint()) });\n    }\n\n    /**\n     * Loads preview in the component using the preview library.\n     *\n     * @return {void}\n     */\n    loadPreview = async (): Promise<void> => {\n        const {\n            advancedContentInsights,\n            annotatorState: { activeAnnotationId } = {},\n            enableThumbnailsSidebar,\n            fileOptions,\n            onAnnotatorEvent,\n            onAnnotator,\n            onContentInsightsEventReport,\n            previewExperiences,\n            showAnnotationsControls,\n            token: tokenOrTokenFunction,\n            ...rest\n        }: Props = this.props;\n        const { file, selectedVersion, startAt }: State = this.state;\n\n        if (!this.isPreviewLibraryLoaded() || !file || !tokenOrTokenFunction) {\n            return;\n        }\n\n        const fileId = this.getFileId(file);\n\n        if (fileId !== this.state.currentFileId) {\n            return;\n        }\n\n        const fileOpts = { ...fileOptions };\n        const token = typedId => TokenService.getReadTokens(typedId, tokenOrTokenFunction);\n\n        if (selectedVersion) {\n            setProp(fileOpts, [fileId, 'fileVersionId'], selectedVersion.id);\n            setProp(fileOpts, [fileId, 'currentFileVersionId'], getProp(file, 'file_version.id'));\n        }\n\n        if (activeAnnotationId) {\n            setProp(fileOpts, [fileId, 'annotations', 'activeId'], activeAnnotationId);\n        }\n\n        if (startAt) {\n            setProp(fileOpts, [fileId, 'startAt'], startAt);\n        }\n\n        const previewOptions = {\n            advancedContentInsights,\n            container: `#${this.id} .bcpr-content`,\n            enableThumbnailsSidebar,\n            fileOptions: fileOpts,\n            header: 'none',\n            headerElement: `#${this.id} .bcpr-PreviewHeader`,\n            experiences: previewExperiences,\n            showAnnotations: this.canViewAnnotations(),\n            showAnnotationsControls,\n            showDownload: this.canDownload(),\n            showLoading: false,\n            showProgress: false,\n            skipServerUpdate: true,\n            useHotkeys: false,\n        };\n        const { Preview } = global.Box;\n        this.preview = new Preview();\n        this.preview.addListener('load', this.onPreviewLoad);\n        this.preview.addListener('preview_error', this.onPreviewError);\n        this.preview.addListener('preview_metric', this.onPreviewMetric);\n        this.preview.addListener('thumbnailsOpen', () => this.setState({ isThumbnailSidebarOpen: true }));\n        this.preview.addListener('thumbnailsClose', () => this.setState({ isThumbnailSidebarOpen: false }));\n\n        if (showAnnotationsControls) {\n            this.preview.addListener('annotator_create', onAnnotator);\n        }\n\n        this.preview.updateFileCache([file]);\n        this.preview.show(file.id, token, {\n            ...previewOptions,\n            ...omit(rest, Object.keys(previewOptions)),\n        });\n        if (advancedContentInsights) {\n            this.preview.addListener('advanced_insights_report', onContentInsightsEventReport);\n        }\n    };\n\n    /**\n     * Updates preview file from temporary staged file.\n     *\n     * @return {void}\n     */\n    loadFileFromStage = () => {\n        if (this.stagedFile) {\n            this.setState({ ...this.initialState, file: this.stagedFile }, () => {\n                this.stagedFile = undefined;\n            });\n        }\n    };\n\n    /**\n     * Removes the reload notification\n     *\n     * @return {void}\n     */\n    closeReloadNotification = () => {\n        this.setState({ isReloadNotificationVisible: false });\n    };\n\n    /**\n     * Tells the preview to resize\n     *\n     * @return {void}\n     */\n    onResize = (): void => {\n        if (this.preview && this.preview.getCurrentViewer()) {\n            this.preview.resize();\n        }\n    };\n\n    /**\n     * File fetch success callback\n     *\n     * @param {Object} file - Box file\n     * @return {void}\n     */\n    fetchFileSuccessCallback = (file: BoxItem): void => {\n        this.fetchFileEndTime = performance.now();\n\n        const { file: currentFile }: State = this.state;\n        const isExistingFile = currentFile ? currentFile.id === file.id : false;\n        const isWatermarked = getProp(file, 'watermark_info.is_watermarked', false);\n\n        // If the file is watermarked or if its a new file, then update the state\n        // In this case preview should reload without prompting the user\n        if (isWatermarked || !isExistingFile) {\n            this.setState({ ...this.initialState, file });\n            // $FlowFixMe file version and sha1 should exist at this point\n        } else if (currentFile.file_version.sha1 !== file.file_version.sha1) {\n            // If we are already prevewing the file that got updated then show the\n            // user a notification to reload the file only if its sha1 changed\n            this.stagedFile = file;\n            this.setState({\n                ...this.initialState,\n                isReloadNotificationVisible: true,\n            });\n        }\n    };\n\n    /**\n     * File fetch error callback\n     *\n     * @return {void}\n     */\n    fetchFileErrorCallback = (fileError: ElementsXhrError, code: string): void => {\n        const { onError } = this.props;\n        const errorCode = fileError.code || code;\n        const error = {\n            code: errorCode,\n            message: fileError.message,\n        };\n        this.setState({ error, file: undefined, isLoading: false });\n        onError(fileError, errorCode, {\n            error: fileError,\n        });\n    };\n\n    /**\n     * Fetches a file\n     *\n     * @param {string} id file id\n     * @param {Function|void} [successCallback] - Callback after file is fetched\n     * @param {Function|void} [errorCallback] - Callback after error\n     * @param {Object|void} [fetchOptions] - Fetch options\n     * @return {void}\n     */\n    fetchFile(\n        id: ?string,\n        successCallback?: Function,\n        errorCallback?: Function,\n        fetchOptions: RequestOptions = {},\n    ): void {\n        if (!id) {\n            return;\n        }\n\n        this.fetchFileStartTime = performance.now();\n        this.fetchFileEndTime = null;\n\n        this.api\n            .getFileAPI()\n            .getFile(\n                id,\n                successCallback || this.fetchFileSuccessCallback,\n                errorCallback || this.fetchFileErrorCallback,\n                {\n                    ...fetchOptions,\n                    fields: PREVIEW_FIELDS_TO_FETCH,\n                },\n            );\n    }\n\n    /**\n     * Returns the preview instance\n     *\n     * @return {Preview} current instance of preview\n     */\n    getPreview = (): any => {\n        const { file }: State = this.state;\n        if (!this.preview || !file) {\n            return null;\n        }\n\n        return this.preview;\n    };\n\n    /**\n     * Returns the viewer instance being used by preview.\n     * This will let child components access the viewers.\n     *\n     * @return {Viewer} current instance of the preview viewer\n     */\n    getViewer = (): any => {\n        const preview = this.getPreview();\n        const viewer = preview ? preview.getCurrentViewer() : null;\n        return viewer && viewer.isLoaded() && !viewer.isDestroyed() ? viewer : null;\n    };\n\n    /**\n     * Finds the index of current file inside the collection\n     *\n     * @return {number} -1 if not indexed\n     */\n    getFileIndex() {\n        const { currentFileId }: State = this.state;\n        const { collection }: Props = this.props;\n        if (!currentFileId || collection.length < 2) {\n            return -1;\n        }\n\n        return collection.findIndex(item => {\n            if (typeof item === 'string') {\n                return item === currentFileId;\n            }\n\n            return item.id === currentFileId;\n        });\n    }\n\n    /**\n     * Shows a preview of a file at the specified index in the current collection.\n     *\n     * @public\n     * @param {number} index - Index of file to preview\n     * @return {void}\n     */\n    navigateToIndex(index: number) {\n        const { collection, onNavigate }: Props = this.props;\n        const { length } = collection;\n        if (length < 2 || index < 0 || index > length - 1) {\n            return;\n        }\n\n        const fileOrId = collection[index];\n        const fileId = typeof fileOrId === 'object' ? fileOrId.id || '' : fileOrId;\n\n        this.setState(\n            {\n                currentFileId: fileId,\n            },\n            () => {\n                // Execute navigation callback\n                onNavigate(fileId);\n            },\n        );\n    }\n\n    /**\n     * Shows a preview of the previous file.\n     *\n     * @public\n     * @return {void}\n     */\n    navigateLeft = () => {\n        const currentIndex = this.getFileIndex();\n        const newIndex = currentIndex === 0 ? 0 : currentIndex - 1;\n        if (newIndex !== currentIndex) {\n            this.navigateToIndex(newIndex);\n        }\n    };\n\n    /**\n     * Shows a preview of the next file.\n     *\n     * @public\n     * @return {void}\n     */\n    navigateRight = () => {\n        const { collection }: Props = this.props;\n        const currentIndex = this.getFileIndex();\n        const newIndex = currentIndex === collection.length - 1 ? collection.length - 1 : currentIndex + 1;\n        if (newIndex !== currentIndex) {\n            this.navigateToIndex(newIndex);\n        }\n    };\n\n    /**\n     * Downloads file.\n     *\n     * @public\n     * @return {void}\n     */\n    download = () => {\n        const { onDownload }: Props = this.props;\n        const { file }: State = this.state;\n        if (this.preview) {\n            this.preview.download();\n            onDownload(cloneDeep(file));\n        }\n    };\n\n    /**\n     * Prints file.\n     *\n     * @public\n     * @return {void}\n     */\n    print = () => {\n        if (this.preview) {\n            this.preview.print();\n        }\n    };\n\n    /**\n     * Mouse move handler that is throttled and show\n     * the navigation arrows if applicable.\n     *\n     * @return {void}\n     */\n    onMouseMove = throttle(() => {\n        const viewer = this.getViewer();\n        const isPreviewing = !!viewer;\n        const CLASS_NAVIGATION_VISIBILITY = 'bcpr-nav-is-visible';\n\n        clearTimeout(this.mouseMoveTimeoutID);\n\n        if (!this.previewContainer) {\n            return;\n        }\n\n        // Always assume that navigation arrows will be hidden\n        this.previewContainer.classList.remove(CLASS_NAVIGATION_VISIBILITY);\n\n        // Only show it if either we aren't previewing or if we are then the viewer\n        // is not blocking the show. If we are previewing then the viewer may choose\n        // to not allow navigation arrows. This is mostly useful for videos since the\n        // navigation arrows may interfere with the settings menu inside video player.\n        if (this.previewContainer && (!isPreviewing || viewer.allowNavigationArrows())) {\n            this.previewContainer.classList.add(CLASS_NAVIGATION_VISIBILITY);\n        }\n\n        this.mouseMoveTimeoutID = setTimeout(() => {\n            if (this.previewContainer) {\n                this.previewContainer.classList.remove(CLASS_NAVIGATION_VISIBILITY);\n            }\n        }, 1500);\n    }, 1000);\n\n    /**\n     * Keyboard events\n     *\n     * @return {void}\n     */\n    onKeyDown = (event: SyntheticKeyboardEvent<HTMLElement>) => {\n        const { useHotkeys }: Props = this.props;\n        if (!useHotkeys) {\n            return;\n        }\n\n        let consumed = false;\n        const key = decode(event);\n        const viewer = this.getViewer();\n\n        // If focus was on an input or if the viewer doesn't exist\n        // then don't bother doing anything further\n        if (!key || !viewer || isInputElement(event.target)) {\n            return;\n        }\n\n        if (typeof viewer.onKeydown === 'function') {\n            consumed = !!viewer.onKeydown(key, event.nativeEvent);\n        }\n\n        if (!consumed) {\n            switch (key) {\n                case 'ArrowLeft':\n                    this.navigateLeft();\n                    consumed = true;\n                    break;\n                case 'ArrowRight':\n                    this.navigateRight();\n                    consumed = true;\n                    break;\n                default:\n                // no-op\n            }\n        }\n\n        if (consumed) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n    };\n\n    /**\n     * Handles version change events\n     *\n     * @param {string} [version] - The version that is now previewed\n     * @param {object} [additionalVersionInfo] - extra info about the version\n     */\n    onVersionChange = (version?: BoxItemVersion, additionalVersionInfo: AdditionalVersionInfo = {}): void => {\n        const { onVersionChange }: Props = this.props;\n        this.updateVersionToCurrent = additionalVersionInfo.updateVersionToCurrent;\n\n        onVersionChange(version, additionalVersionInfo);\n        this.setState({\n            selectedVersion: version,\n        });\n    };\n\n    handleAnnotationSelect = ({ file_version, id, target }: Annotation) => {\n        const { location = {} } = target;\n        const { file, selectedVersion } = this.state;\n        const annotationFileVersionId = getProp(file_version, 'id');\n        const currentFileVersionId = getProp(file, 'file_version.id');\n        const currentPreviewFileVersionId = getProp(selectedVersion, 'id', currentFileVersionId);\n        const unit = startAtTypes[location.type];\n        const viewer = this.getViewer();\n\n        if (unit && annotationFileVersionId && annotationFileVersionId !== currentPreviewFileVersionId) {\n            this.setState({\n                startAt: {\n                    unit,\n                    value: location.value,\n                },\n            });\n        }\n\n        if (viewer) {\n            viewer.emit('scrolltoannotation', { id, target });\n        }\n    };\n\n    /**\n     * Holds the reference the preview container\n     *\n     * @return {void}\n     */\n    containerRef = (container: ?HTMLDivElement) => {\n        this.previewContainer = container;\n    };\n\n    /**\n     * Refreshes the content sidebar panel\n     *\n     * @return {void}\n     */\n    refreshSidebar(): void {\n        const { current: contentSidebar } = this.contentSidebar;\n\n        if (contentSidebar) {\n            contentSidebar.refresh();\n        }\n    }\n\n    /**\n     * Fetches a thumbnail for the page given\n     *\n     * @return {Promise|null} - promise resolves with the image HTMLElement or null if generation is in progress\n     */\n    getThumbnail = (pageNumber: ?number): Promise<HTMLElement> | null => {\n        const preview = this.getPreview();\n        if (preview && preview.viewer) {\n            return preview.viewer.getThumbnail(pageNumber);\n        }\n\n        return null;\n    };\n\n    /**\n     * Renders the file preview\n     *\n     * @inheritdoc\n     * @return {Element}\n     */\n    render() {\n        const {\n            apiHost,\n            collection,\n            token,\n            language,\n            messages,\n            className,\n            contentSidebarProps,\n            contentOpenWithProps,\n            hasHeader,\n            history,\n            isLarge,\n            isVeryLarge,\n            logoUrl,\n            onClose,\n            measureRef,\n            sharedLink,\n            sharedLinkPassword,\n            requestInterceptor,\n            responseInterceptor,\n        }: Props = this.props;\n\n        const {\n            canPrint,\n            currentFileId,\n            error,\n            file,\n            isLoading,\n            isReloadNotificationVisible,\n            isThumbnailSidebarOpen,\n            selectedVersion,\n        }: State = this.state;\n\n        const styleClassName = classNames(\n            'be bcpr',\n            {\n                'bcpr-thumbnails-open': isThumbnailSidebarOpen,\n            },\n            className,\n        );\n\n        if (!currentFileId) {\n            return null;\n        }\n\n        const errorCode = getProp(error, 'code');\n        const currentExtension = getProp(file, 'id') === currentFileId ? getProp(file, 'extension') : '';\n        const currentVersionId = getProp(file, 'file_version.id');\n        const selectedVersionId = getProp(selectedVersion, 'id', currentVersionId);\n        const onHeaderClose = currentVersionId === selectedVersionId ? onClose : this.updateVersionToCurrent;\n\n        /* eslint-disable jsx-a11y/no-static-element-interactions */\n        /* eslint-disable jsx-a11y/no-noninteractive-tabindex */\n        return (\n            <Internationalize language={language} messages={messages}>\n                <div id={this.id} className={styleClassName} ref={measureRef} onKeyDown={this.onKeyDown} tabIndex={0}>\n                    {hasHeader && (\n                        <PreviewHeader\n                            file={file}\n                            logoUrl={logoUrl}\n                            token={token}\n                            onClose={onHeaderClose}\n                            onPrint={this.print}\n                            canDownload={this.canDownload()}\n                            canPrint={canPrint}\n                            onDownload={this.download}\n                            contentOpenWithProps={contentOpenWithProps}\n                            canAnnotate={this.canAnnotate()}\n                            selectedVersion={selectedVersion}\n                        />\n                    )}\n                    <div className=\"bcpr-body\">\n                        <div className=\"bcpr-container\" onMouseMove={this.onMouseMove} ref={this.containerRef}>\n                            {file && (\n                                <Measure bounds onResize={this.onResize}>\n                                    {({ measureRef: previewRef }) => <div ref={previewRef} className=\"bcpr-content\" />}\n                                </Measure>\n                            )}\n                            <PreviewMask errorCode={errorCode} extension={currentExtension} isLoading={isLoading} />\n                            <PreviewNavigation\n                                collection={collection}\n                                currentIndex={this.getFileIndex()}\n                                onNavigateLeft={this.navigateLeft}\n                                onNavigateRight={this.navigateRight}\n                            />\n                        </div>\n                        {file && (\n                            <LoadableSidebar\n                                {...contentSidebarProps}\n                                apiHost={apiHost}\n                                token={token}\n                                cache={this.api.getCache()}\n                                fileId={currentFileId}\n                                getPreview={this.getPreview}\n                                getViewer={this.getViewer}\n                                history={history}\n                                isDefaultOpen={isLarge || isVeryLarge}\n                                language={language}\n                                ref={this.contentSidebar}\n                                sharedLink={sharedLink}\n                                sharedLinkPassword={sharedLinkPassword}\n                                requestInterceptor={requestInterceptor}\n                                responseInterceptor={responseInterceptor}\n                                onAnnotationSelect={this.handleAnnotationSelect}\n                                onVersionChange={this.onVersionChange}\n                            />\n                        )}\n                    </div>\n                    {isReloadNotificationVisible && (\n                        <ReloadNotification onClose={this.closeReloadNotification} onClick={this.loadFileFromStage} />\n                    )}\n                </div>\n            </Internationalize>\n        );\n        /* eslint-enable jsx-a11y/no-static-element-interactions */\n        /* eslint-enable jsx-a11y/no-noninteractive-tabindex */\n    }\n}\n\nexport type ContentPreviewProps = Props;\nexport { ContentPreview as ContentPreviewComponent };\nexport default flow([\n    makeResponsive,\n    withAnnotatorContext,\n    withAnnotations,\n    withRouter,\n    withNavRouter,\n    withFeatureProvider,\n    withLogger(ORIGIN_CONTENT_PREVIEW),\n    withErrorBoundary(ORIGIN_CONTENT_PREVIEW),\n])(ContentPreview);\n"],"file":"ContentPreview.js"}